
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Record building workflow &#8212; NexusLIMS 2.3.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=acda69ee" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=c3c8ae58"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=30646c52"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.2.0/dist/mermaid-layout-elk.esm.min.mjs"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.2.0/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs";

const defaultStyle = document.createElement('style');
defaultStyle.textContent = `pre.mermaid {
    /* Same as .mermaid-container > pre */
    display: block;
    width: 100%;
}

pre.mermaid > svg {
    /* Same as .mermaid-container > pre > svg */
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}
`;
document.head.appendChild(defaultStyle);

const fullscreenStyle = document.createElement('style');
fullscreenStyle.textContent = `.mermaid-container {
    display: flex;
    flex-direction: row;
    width: 100%;
}

.mermaid-container > pre {
    display: block;
    width: 100%;
}

.mermaid-container > pre > svg {
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}

.mermaid-fullscreen-btn {
    width: 28px;
    height: 28px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    font-size: 14px;
    line-height: 1;
    padding: 0;
    color: #333;
}

.mermaid-fullscreen-btn:hover {
    opacity: 100% !important;
    background: rgba(255, 255, 255, 1);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    transform: scale(1.1);
}

.mermaid-fullscreen-btn.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #e0e0e0;
}

.mermaid-fullscreen-btn.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 3px 10px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal {
    display: none;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 95vw;
    height: 100vh;
    background: rgba(255, 255, 255, 0.98);
    z-index: 9999;
    padding: 20px;
    overflow: auto;
}

.mermaid-fullscreen-modal.dark-theme {
    background: rgba(0, 0, 0, 0.98);
}

.mermaid-fullscreen-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen {
    position: relative;
    width: 95vw;
    height: 90vh;
    max-width: 95vw;
    max-height: 90vh;
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    overflow: auto;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen.dark-theme {
    background: #1a1a1a;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
}

.mermaid-container-fullscreen pre.mermaid {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen .mermaid svg {
    height: 100% !important;
    width: 100% !important;
    cursor: grab;
}

.mermaid-fullscreen-close {
    position: fixed !important;
    top: 20px !important;
    right: 20px !important;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.2);
    border-radius: 50%;
    cursor: pointer;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: all 0.2s;
    font-size: 24px;
    line-height: 1;
    color: #333;
}

.mermaid-fullscreen-close:hover {
    background: white;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    transform: scale(1.1);
}

.mermaid-fullscreen-close.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #e0e0e0;
}

.mermaid-fullscreen-close.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 6px 16px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal .mermaid-fullscreen-btn {
    display: none !important;
}`;
document.head.appendChild(fullscreenStyle);

// Detect if page has dark background
const isDarkTheme = () => {
    const bgColor = window.getComputedStyle(document.body).backgroundColor;
    const match = bgColor.match(/rgb\((\d+),\s*(\d+),\s*(\d+)/);
    if (match) {
        const r = parseInt(match[1]);
        const g = parseInt(match[2]);
        const b = parseInt(match[3]);
        const brightness = (r * 299 + g * 587 + b * 114) / 1000;
        return brightness < 128;
    }
    return false;
};

const load = async () => {
    await mermaid.run();

    const all_mermaids = document.querySelectorAll(".mermaid");
    const mermaids_processed = document.querySelectorAll(".mermaid[data-processed='true']");

    if ("True" === "True") {
        const mermaids_to_add_zoom = -1 === -1 ? all_mermaids.length : -1;
        if(mermaids_to_add_zoom > 0) {
            var svgs = d3.selectAll(".mermaid svg");
            if(all_mermaids.length !== mermaids_processed.length) {
                setTimeout(load, 200);
                return;
            } else if(svgs.size() !== mermaids_to_add_zoom) {
                setTimeout(load, 200);
                return;
            } else {
                svgs.each(function() {
                    var svg = d3.select(this);
                    svg.html("<g class='wrapper'>" + svg.html() + "</g>");
                    var inner = svg.select("g");
                    var zoom = d3.zoom().on("zoom", function(event) {
                        inner.attr("transform", event.transform);
                    });
                    svg.call(zoom);
                });
            }
        }
    } else if(all_mermaids.length !== mermaids_processed.length) {
        // Wait for mermaid to process all diagrams
        setTimeout(load, 200);
        return;
    }

    const darkTheme = isDarkTheme();

    // Stop here if not adding fullscreen capability
    if ("True" !== "True") return;

    const modal = document.createElement('div');
    modal.className = 'mermaid-fullscreen-modal' + (darkTheme ? ' dark-theme' : '');
    modal.setAttribute('role', 'dialog');
    modal.setAttribute('aria-modal', 'true');
    modal.setAttribute('aria-label', 'Fullscreen diagram viewer');
    modal.innerHTML = `
        <button class="mermaid-fullscreen-close${darkTheme ? ' dark-theme' : ''}" aria-label="Close fullscreen">✕</button>
        <div class="mermaid-container-fullscreen${darkTheme ? ' dark-theme' : ''}"></div>
    `;
    document.body.appendChild(modal);

    const modalContent = modal.querySelector('.mermaid-container-fullscreen');
    const closeBtn = modal.querySelector('.mermaid-fullscreen-close');

    let previousScrollOffset = [window.scrollX, window.scrollY];

    const closeModal = () => {
        modal.classList.remove('active');
        modalContent.innerHTML = '';
        document.body.style.overflow = ''
        window.scrollTo({left: previousScrollOffset[0], top: previousScrollOffset[1], behavior: 'instant'});
    };

    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            closeModal();
        }
    });

    const allButtons = [];

    document.querySelectorAll('.mermaid').forEach((mermaidDiv) => {
        if (mermaidDiv.parentNode.classList.contains('mermaid-container') ||
            mermaidDiv.closest('.mermaid-fullscreen-modal')) {
            return;
        }

        const container = document.createElement('div');
        container.className = 'mermaid-container';
        mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
        container.appendChild(mermaidDiv);

        const fullscreenBtn = document.createElement('button');
        fullscreenBtn.className = 'mermaid-fullscreen-btn' + (darkTheme ? ' dark-theme' : '');
        fullscreenBtn.setAttribute('aria-label', 'View diagram in fullscreen');
        fullscreenBtn.textContent = '⛶';
        fullscreenBtn.style.opacity = '50%';

        // Calculate dynamic position based on diagram's margin and padding
        const diagramStyle = window.getComputedStyle(mermaidDiv);
        const marginTop = parseFloat(diagramStyle.marginTop) || 0;
        const marginRight = parseFloat(diagramStyle.marginRight) || 0;
        const paddingTop = parseFloat(diagramStyle.paddingTop) || 0;
        const paddingRight = parseFloat(diagramStyle.paddingRight) || 0;
        fullscreenBtn.style.top = `${marginTop + paddingTop + 4}px`;
        fullscreenBtn.style.right = `${marginRight + paddingRight + 4}px`;

        fullscreenBtn.addEventListener('click', () => {
            previousScrollOffset = [window.scroll, window.scrollY];
            const clone = mermaidDiv.cloneNode(true);
            modalContent.innerHTML = '';
            modalContent.appendChild(clone);

            const svg = clone.querySelector('svg');
            if (svg) {
                svg.removeAttribute('width');
                svg.removeAttribute('height');
                svg.style.width = '100%';
                svg.style.height = 'auto';
                svg.style.maxWidth = '100%';
                svg.style.sdisplay = 'block';

                if ("True" === "True") {
                    setTimeout(() => {
                        const g = svg.querySelector('g');
                        if (g) {
                            var svgD3 = d3.select(svg);
                            svgD3.html("<g class='wrapper'>" + svgD3.html() + "</g>");
                            var inner = svgD3.select("g");
                            var zoom = d3.zoom().on("zoom", function(event) {
                                inner.attr("transform", event.transform);
                            });
                            svgD3.call(zoom);
                        }
                    }, 100);
                }
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });

        container.appendChild(fullscreenBtn);
        allButtons.push(fullscreenBtn);
    });

    // Update theme classes when theme changes
    const updateTheme = () => {
        const dark = isDarkTheme();
        allButtons.forEach(btn => {
            if (dark) {
                btn.classList.add('dark-theme');
            } else {
                btn.classList.remove('dark-theme');
            }
        });
        if (dark) {
            modal.classList.add('dark-theme');
            modalContent.classList.add('dark-theme');
            closeBtn.classList.add('dark-theme');
        } else {
            modal.classList.remove('dark-theme');
            modalContent.classList.remove('dark-theme');
            closeBtn.classList.remove('dark-theme');
        }
    };

    // Watch for theme changes
    const observer = new MutationObserver(updateTheme);
    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class', 'style', 'data-theme']
    });
    observer.observe(document.body, {
        attributes: true,
        attributeFilter: ['class', 'style']
    });
};

window.addEventListener("load", load);
</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/record_building';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = '_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '2.3.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            true;
        </script>
    <script src="../_static/custom.js?v=ba087cdf"></script>
    <link rel="icon" href="../_static/nexusLIMS_bare_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Extractors" href="extractors.html" />
    <link rel="prev" title="Configuration" href="configuration.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="2.3.0" />
    <meta name="docbuild:last-update" content="Jan, 20, 2026"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_horizontal_light.png" class="logo__image only-light" alt="NexusLIMS 2.3.0 documentation - Home"/>
    <img src="../_static/logo_horizontal_dark.png" class="logo__image only-dark pst-js-only" alt="NexusLIMS 2.3.0 documentation - Home"/>
  
  
</a></div>
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    Home
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../migration.html">
    Migration Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../dev_guide.html">
    Dev Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../frontend_guide.html">
    Frontend Guide
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../reference.html">
    Reference
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/datasophos/NexusLIMS" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://datasophos.co" title="Datasophos" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-globe fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Datasophos</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    Home
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../migration.html">
    Migration Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../dev_guide.html">
    Dev Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../frontend_guide.html">
    Frontend Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/datasophos/NexusLIMS" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://datasophos.co" title="Datasophos" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-globe fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Datasophos</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Record building workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="extractors.html">Extractors</a></li>
<li class="toctree-l1"><a class="reference internal" href="taxonomy.html">NexusLIMS Taxonomy</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../user_guide.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Record building workflow</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="record-building-workflow">
<span id="record-building"></span><h1>Record building workflow<a class="headerlink" href="#record-building-workflow" title="Link to this heading">#</a></h1>
<p>NexusLIMS automatically builds XML records from electron microscopy data by combining
session information from the database with metadata extracted from data files. This page
explains the workflow from session detection to record upload. See the
<a class="reference internal" href="#activity-diagram"><span class="std std-ref">activity diagram</span></a> at the bottom for a visual overview.</p>
<p>Links to API reference documentation are provided throughout.</p>
<section id="general-approach">
<span id="id1"></span><h2>General Approach<a class="headerlink" href="#general-approach" title="Link to this heading">#</a></h2>
<p>Since instruments cannot communicate directly with NexusLIMS, the system uses periodic
polling (via <code class="docutils literal notranslate"><span class="pre">systemd</span></code> or <code class="docutils literal notranslate"><span class="pre">cron</span></code>) to detect sessions requiring record generation.</p>
<p><strong>Execution:</strong> Run <code class="docutils literal notranslate"><span class="pre">nexuslims-process-records</span></code> (or <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">nexusLIMS.cli.process_records</span></code>) to invoke
<a class="reference internal" href="../api/nexusLIMS/nexusLIMS.builder.record_builder.html#nexusLIMS.builder.record_builder.process_new_records" title="nexusLIMS.builder.record_builder.process_new_records"><code class="xref py py-func docutils literal notranslate"><span class="pre">process_new_records()</span></code></a>, which:</p>
<ol class="arabic simple">
<li><p>Queries NEMO APIs for recent usage events</p></li>
<li><p>Finds database sessions awaiting record generation</p></li>
<li><p>Searches the centralized file system for matching files</p></li>
<li><p>Extracts metadata and groups files into <code class="docutils literal notranslate"><span class="pre">Acquisition</span> <span class="pre">Activities</span></code></p></li>
<li><p>Builds and validates XML records against the Nexus Microscopy Schema</p></li>
<li><p>Uploads valid records to the CDCS instance</p></li>
</ol>
<p><strong>Error handling:</strong> Failed builds are logged to the database with <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> status,
triggering operator notifications.</p>
</section>
<section id="finding-new-sessions">
<h2>Finding New Sessions<a class="headerlink" href="#finding-new-sessions" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.builder.record_builder.html#nexusLIMS.builder.record_builder.process_new_records" title="nexusLIMS.builder.record_builder.process_new_records"><code class="xref py py-func docutils literal notranslate"><span class="pre">process_new_records()</span></code></a> discovers sessions
requiring record generation through two steps:</p>
<ol class="arabic">
<li><p><strong>Harvest NEMO events:</strong> <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.harvesters.nemo.utils.html#nexusLIMS.harvesters.nemo.utils.add_all_usage_events_to_db" title="nexusLIMS.harvesters.nemo.utils.add_all_usage_events_to_db"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_all_usage_events_to_db()</span></code></a>
queries configured NEMO APIs for recent usage events (default: 7 days lookback) and
adds them to the session log database.</p></li>
<li><p><strong>Query pending sessions:</strong> <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.db.session_handler.html#nexusLIMS.db.session_handler.get_sessions_to_build" title="nexusLIMS.db.session_handler.get_sessions_to_build"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_sessions_to_build()</span></code></a>
finds sessions with <code class="docutils literal notranslate"><span class="pre">TO_BE_BUILT</span></code> status:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="p">(</span><span class="n">session_identifier</span><span class="p">,</span><span class="w"> </span><span class="n">instrument</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">event_type</span><span class="p">,</span><span class="w"> </span><span class="k">user</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">session_log</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">record_status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;TO_BE_BUILT&#39;</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<p>Results are converted to <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.db.models.html#nexusLIMS.db.models.SessionLog" title="nexusLIMS.db.models.SessionLog"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionLog</span></code></a> objects,
then paired into <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.db.session_handler.html#nexusLIMS.db.session_handler.Session" title="nexusLIMS.db.session_handler.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> objects by matching
<code class="docutils literal notranslate"><span class="pre">START</span></code> and <code class="docutils literal notranslate"><span class="pre">END</span></code> logs with the same <code class="docutils literal notranslate"><span class="pre">session_identifier</span></code>.</p>
<section id="session-attributes">
<h3>Session Attributes<a class="headerlink" href="#session-attributes" title="Link to this heading">#</a></h3>
<p>Each <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.db.session_handler.html#nexusLIMS.db.session_handler.Session" title="nexusLIMS.db.session_handler.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> contains:</p>
<ul class="simple" id="session-contents">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">session_identifier</span></code></strong> (<a class="reference external" href="https://docs.python.org/3.11/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>): Session ID ( resolvable URL for NEMO events)</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">instrument</span></code></strong> (<a class="reference internal" href="../api/nexusLIMS/nexusLIMS.db.models.html#nexusLIMS.db.models.Instrument" title="nexusLIMS.db.models.Instrument"><code class="xref py py-class docutils literal notranslate"><span class="pre">Instrument</span></code></a>): Associated instrument object</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">dt_from</span></code></strong> (<a class="reference external" href="https://docs.python.org/3.11/library/datetime.html#datetime.datetime" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a>): Session start time</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">dt_to</span></code></strong> (<a class="reference external" href="https://docs.python.org/3.11/library/datetime.html#datetime.datetime" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a>): Session end time</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">user</span></code></strong> (<a class="reference external" href="https://docs.python.org/3.11/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>): Username (may be unreliable if instrument doesn’t require login)</p></li>
</ul>
<p>Sessions are processed sequentially by the record builder.</p>
</section>
</section>
<section id="building-a-single-record">
<h2>Building a Single Record<a class="headerlink" href="#building-a-single-record" title="Link to this heading">#</a></h2>
<p>For each <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.db.session_handler.html#nexusLIMS.db.session_handler.Session" title="nexusLIMS.db.session_handler.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>, the record builder
executes these steps:</p>
<section id="process-overview">
<span id="overview"></span><h3>Process Overview<a class="headerlink" href="#process-overview" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong><a class="reference internal" href="#starting-record-builder"><span class="std std-ref">(link)</span></a> Initiate build</strong>: Execute <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.builder.record_builder.html#nexusLIMS.builder.record_builder.build_record" title="nexusLIMS.builder.record_builder.build_record"><code class="xref py py-func docutils literal notranslate"><span class="pre">build_record()</span></code></a></p></li>
<li><p><strong><a class="reference internal" href="#harvesting-calendar"><span class="std std-ref">(link)</span></a> Fetch reservation data</strong>: Query harvesters (e.g., <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.harvesters.nemo.html#module-nexusLIMS.harvesters.nemo" title="nexusLIMS.harvesters.nemo"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nemo</span></code></a>)</p></li>
<li><p><strong><a class="reference internal" href="#identifying-files"><span class="std std-ref">(link)</span></a> Find files</strong>: Search for parseable files within session timespan</p>
<ul class="simple">
<li><p>If none found → mark as <code class="docutils literal notranslate"><span class="pre">NO_FILES_FOUND</span></code> and skip to next session</p></li>
</ul>
</li>
<li><p><strong><a class="reference internal" href="#build-activities"><span class="std std-ref">(link)</span></a> Cluster activities</strong>: Group files into <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.activity.html#nexusLIMS.schemas.activity.AcquisitionActivity" title="nexusLIMS.schemas.activity.AcquisitionActivity"><code class="xref py py-class docutils literal notranslate"><span class="pre">AcquisitionActivity</span></code></a> objects using temporal analysis</p></li>
<li><p><strong><a class="reference internal" href="#parse-metadata"><span class="std std-ref">(link)</span></a> Extract metadata</strong>: Parse each file’s metadata and generate preview images</p></li>
<li><p><strong><a class="reference internal" href="#separate-setup-parameters"><span class="std std-ref">(link)</span></a> Organize metadata</strong>: Separate common metadata (setup parameters) from file-specific values</p></li>
<li><p><strong><a class="reference internal" href="#validating-the-record"><span class="std std-ref">(link)</span></a> Validate</strong>: Check XML against Nexus Microscopy Schema</p></li>
<li><p><strong><a class="reference internal" href="#upload-records"><span class="std std-ref">(link)</span></a> Upload</strong>: Push valid records to CDCS and update database</p></li>
</ol>
</section>
<section id="initiating-the-build">
<span id="starting-record-builder"></span><h3>1. Initiating the Build<a class="headerlink" href="#initiating-the-build" title="Link to this heading">#</a></h3>
<p>Before building each record:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.db.session_handler.html#nexusLIMS.db.session_handler.Session.insert_record_generation_event" title="nexusLIMS.db.session_handler.Session.insert_record_generation_event"><code class="xref py py-meth docutils literal notranslate"><span class="pre">insert_record_generation_event()</span></code></a> logs
the build attempt to the database for audit purposes</p></li>
<li><p><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.builder.record_builder.html#nexusLIMS.builder.record_builder.build_record" title="nexusLIMS.builder.record_builder.build_record"><code class="xref py py-func docutils literal notranslate"><span class="pre">build_record()</span></code></a> is invoked with the
session’s instrument and timestamp information</p></li>
<li><p>Basic XML header is written before querying the reservation system</p></li>
</ol>
<p><a class="reference internal" href="#overview"><span class="std std-ref">(go to top)</span></a></p>
</section>
<section id="querying-the-reservation-tool-usage-calendars">
<span id="harvesting-calendar"></span><h3>2. Querying the Reservation/Tool Usage Calendars<a class="headerlink" href="#querying-the-reservation-tool-usage-calendars" title="Link to this heading">#</a></h3>
<p>Instrument reservation and usage tracking systems (like NEMO) provide experiment metadata
(user, sample, motivation, etc.) for the record’s <code class="docutils literal notranslate"><span class="pre">&lt;summary&gt;</span></code> element.</p>
<p>The record builder queries the harvester specified in the instrument’s database entry
(typically <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.harvesters.nemo.html#module-nexusLIMS.harvesters.nemo" title="nexusLIMS.harvesters.nemo"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nemo</span></code></a>). Each harvester implements
<code class="docutils literal notranslate"><span class="pre">res_event_from_session()</span></code>, which returns a
<a class="reference internal" href="../api/nexusLIMS/nexusLIMS.harvesters.reservation_event.html#nexusLIMS.harvesters.reservation_event.ReservationEvent" title="nexusLIMS.harvesters.reservation_event.ReservationEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReservationEvent</span></code></a> object representing
the reservation with maximum time overlap (or a generic event if none found).</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 2.3.0: </span>While the class is named <code class="docutils literal notranslate"><span class="pre">ReservationEvent</span></code> for historical reasons, it can contain
metadata harvested from either <em>Reservations</em> or <em>Usage Events</em> (actual instrument
usage sessions). This capability prioritizes Usage Event data since it
reflects what was actually performed, falling back to Reservation data when usage
information is unavailable.</p>
</div>
<p>This adapter layer provides uniform reservation data regardless of the source system.
The event is then serialized to schema-compliant XML.</p>
<section id="three-tier-fallback-strategy-for-nemo">
<h4>Three-Tier Fallback Strategy for NEMO<a class="headerlink" href="#three-tier-fallback-strategy-for-nemo" title="Link to this heading">#</a></h4>
<p>For NEMO-based systems, the harvester uses a <strong>three-tier fallback strategy</strong> to obtain
experiment metadata, prioritizing the most recent and accurate information:</p>
<p><strong>Priority 1: Post-Run Questions (<code class="docutils literal notranslate"><span class="pre">run_data</span></code>)</strong></p>
<p>The highest priority source is the <code class="docutils literal notranslate"><span class="pre">run_data</span></code> field from NEMO usage events. This field
is populated when users answer questions <strong>at the end</strong> of their instrument session
(when they “enable” the tool to end their usage). Since these questions are answered
after the experiment completes, they represent the most accurate description of what
was actually performed.</p>
<p><strong>Priority 2: Pre-Run Questions (<code class="docutils literal notranslate"><span class="pre">pre_run_data</span></code>)</strong></p>
<p>If <code class="docutils literal notranslate"><span class="pre">run_data</span></code> is empty or invalid, the harvester falls back to the <code class="docutils literal notranslate"><span class="pre">pre_run_data</span></code> field.
This field is populated when users answer questions <strong>at the start</strong> of their instrument
session (when they initially “enable” the tool). While potentially less accurate
than post-run data (since the experiment plan may change during execution),
this provides valuable metadata when users don’t complete post-run questions.</p>
<p><strong>Priority 3: Reservation Matching</strong></p>
<p>If neither usage event question data source is available, the harvester falls back to
traditional reservation matching. The system finds the reservation with maximum time
overlap with the usage event and extracts metadata from the reservation’s question data.
This is the least reliable method since reservations may be created well in advance and
might not reflect the actual experiment performed.</p>
<div class="tip admonition">
<p class="admonition-title">Question Data Structure</p>
<p>All three sources (<code class="docutils literal notranslate"><span class="pre">run_data</span></code>, <code class="docutils literal notranslate"><span class="pre">pre_run_data</span></code>, and reservation <code class="docutils literal notranslate"><span class="pre">question_data</span></code>) use
identical JSON structure, enabling consistent metadata extraction. Both usage event
fields are JSON-encoded strings that are parsed and validated during harvesting.</p>
<p>See <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.harvesters.nemo.html#nexusLIMS.harvesters.nemo.res_event_from_session" title="nexusLIMS.harvesters.nemo.res_event_from_session"><code class="xref py py-func docutils literal notranslate"><span class="pre">res_event_from_session()</span></code></a> documentation for
the required question structure and examples.</p>
</div>
</section>
<section id="data-consent-validation">
<h4>Data Consent Validation<a class="headerlink" href="#data-consent-validation" title="Link to this heading">#</a></h4>
<p>All metadata sources require affirmative user consent via a <code class="docutils literal notranslate"><span class="pre">data_consent</span></code> question.
The harvester validates consent for each source in priority order:</p>
<ul class="simple">
<li><p><strong>Missing consent field</strong>: Falls back to next priority level or raises
<a class="reference internal" href="../api/nexusLIMS/nexusLIMS.harvesters.nemo.exceptions.html#nexusLIMS.harvesters.nemo.exceptions.NoDataConsentError" title="nexusLIMS.harvesters.nemo.exceptions.NoDataConsentError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NoDataConsentError</span></code></a></p></li>
<li><p><strong>Declined consent</strong> (“Disagree”, “No”, etc.): Falls back to next priority level or
raises <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.harvesters.nemo.exceptions.html#nexusLIMS.harvesters.nemo.exceptions.NoDataConsentError" title="nexusLIMS.harvesters.nemo.exceptions.NoDataConsentError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NoDataConsentError</span></code></a></p></li>
<li><p><strong>Invalid JSON or missing question data</strong>: Falls back to next priority level</p></li>
</ul>
<p>If all three tiers fail (no valid question data with consent), the session is marked
<code class="docutils literal notranslate"><span class="pre">NO_CONSENT</span></code> or <code class="docutils literal notranslate"><span class="pre">NO_RESERVATION</span></code> in the database and no record is generated.</p>
</section>
<section id="graceful-degradation">
<h4>Graceful Degradation<a class="headerlink" href="#graceful-degradation" title="Link to this heading">#</a></h4>
<p>The three-tier system provides graceful degradation:</p>
<ol class="arabic simple">
<li><p>Empty strings, malformed JSON, or missing fields in higher-priority sources
automatically trigger fallback to the next tier</p></li>
<li><p>Each tier is validated independently for data completeness and consent</p></li>
<li><p>Logging tracks which data source was ultimately used for each session</p></li>
<li><p>The system prioritizes data quality over data availability</p></li>
</ol>
<p>This approach maximizes record generation success while preferring the most accurate
metadata source available for each session.</p>
<p><a class="reference internal" href="#overview"><span class="std std-ref">(go to top)</span></a></p>
</section>
</section>
<section id="identifying-files">
<span id="identifying-files-to-include"></span><h3>3. Identifying Files to Include<a class="headerlink" href="#identifying-files" title="Link to this heading">#</a></h3>
<p>Record metadata is primarily extracted from session files. The
<a class="reference internal" href="../api/nexusLIMS/nexusLIMS.db.session_handler.html#nexusLIMS.db.session_handler.Session" title="nexusLIMS.db.session_handler.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> provides the instrument,
timespan, and identifier. Instrument configuration (persistent ID, location,
file storage path relative to <a class="reference internal" href="configuration.html#config-instrument-data-path"><span class="std std-ref">NX_INSTRUMENT_DATA_PATH</span></a>)
is read from the database <code class="docutils literal notranslate"><span class="pre">instruments</span></code> table, centralizing configuration management.</p>
<p><strong>File search strategy:</strong></p>
<ol class="arabic simple">
<li><p><strong>Primary:</strong> <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.utils.html#nexusLIMS.utils.gnu_find_files_by_mtime" title="nexusLIMS.utils.gnu_find_files_by_mtime"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gnu_find_files_by_mtime()</span></code></a> uses GNU
<a class="reference external" href="https://www.gnu.org/software/findutils/"><code class="docutils literal notranslate"><span class="pre">find</span></code></a> (available on Linux/macOS, ~tens of seconds)</p></li>
<li><p><strong>Fallback:</strong> <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.utils.html#nexusLIMS.utils.find_files_by_mtime" title="nexusLIMS.utils.find_files_by_mtime"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_files_by_mtime()</span></code></a> provides pure-Python
implementation (~3× slower if GNU find unavailable)</p></li>
</ol>
<p>Only files modified within the session timespan are returned.</p>
<p><strong>No files found:</strong> Sessions without matching files (accidental session start, no data generated)
are marked <code class="docutils literal notranslate"><span class="pre">NO_FILES_FOUND</span></code> and the builder moves to the next session.
<a class="reference internal" href="#overview"><span class="std std-ref">(go to top)</span></a></p>
</section>
<section id="separating-acquisition-activities">
<span id="build-activities"></span><h3>4. Separating Acquisition Activities<a class="headerlink" href="#separating-acquisition-activities" title="Link to this heading">#</a></h3>
<p>Files are grouped into logical <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.activity.html#nexusLIMS.schemas.activity.AcquisitionActivity" title="nexusLIMS.schemas.activity.AcquisitionActivity"><code class="xref py py-class docutils literal notranslate"><span class="pre">AcquisitionActivity</span></code></a>
objects to approximate conceptual experiment boundaries using statistical analysis of
file creation times.</p>
<p>The figure below illustrates the clustering process for an EELS spectrum image
experiment. Panel (a) shows creation time differences revealing 13 distinct groups.
Panel (b) histograms time gaps between consecutive files—small gaps indicate
related files, large gaps mark activity boundaries.</p>
<figure class="align-default" id="id2" style="width: 80%">
<span id="cluster-fig"></span><a class="reference internal image-reference" href="../_images/file_clustering.png"><img alt="How groups of files are separated into Acquisition Activities" src="../_images/file_clustering.png" style="width: 640.0px; height: 480.0px;" />
</a>
<figcaption>
<p><span class="caption-text">An example of determining the
<a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.activity.html#nexusLIMS.schemas.activity.AcquisitionActivity" title="nexusLIMS.schemas.activity.AcquisitionActivity"><code class="xref py py-class docutils literal notranslate"><span class="pre">AcquisitionActivity</span></code></a> time boundaries
for a group of files collected during an experiment. See the surrounding
text for a full explanation of these plots.</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p><strong>Clustering algorithm:</strong> <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.activity.html#nexusLIMS.schemas.activity.cluster_filelist_mtimes" title="nexusLIMS.schemas.activity.cluster_filelist_mtimes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cluster_filelist_mtimes()</span></code></a>
uses <a class="reference external" href="https://scikit-learn.org/stable/modules/density.html#kernel-density">Kernel Density Estimation</a>
(KDE) to detect temporal gaps. The KDE peaks where files cluster in time and minimizes
at gaps. Grid search cross-validation optimizes the KDE bandwidth for each session.
Local minima become activity boundaries (panel c).</p>
<p>Panel (d) overlays boundaries on the original time plot, successfully identifying
all 13 groups as a human would. This approach generalizes well across file types
and experiment patterns.</p>
<p><a class="reference internal" href="#overview"><span class="std std-ref">(go to top)</span></a></p>
</section>
<section id="parsing-individual-files-metadata">
<span id="parse-metadata"></span><h3>5. Parsing Individual Files’ Metadata<a class="headerlink" href="#parsing-individual-files-metadata" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.extractors.html#nexusLIMS.extractors.parse_metadata" title="nexusLIMS.extractors.parse_metadata"><code class="xref py py-func docutils literal notranslate"><span class="pre">parse_metadata()</span></code></a> dispatches to format-specific extractors
in <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.extractors.html#module-nexusLIMS.extractors" title="nexusLIMS.extractors"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nexusLIMS.extractors</span></code></a>. Each extractor returns a <a class="reference external" href="https://docs.python.org/3.11/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> with native
metadata plus a top-level <code class="docutils literal notranslate"><span class="pre">'nx_meta'</span></code> key containing normalized metadata for the XML record.</p>
<p><strong>Metadata Validation (v2.2.0+):</strong></p>
<p>Pydantic schemas (<a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.metadata.html#module-nexusLIMS.schemas.metadata" title="nexusLIMS.schemas.metadata"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nexusLIMS.schemas.metadata</span></code></a>) validate metadata quality:</p>
<ol class="arabic simple">
<li><p><strong>Schema selection</strong> by <code class="docutils literal notranslate"><span class="pre">DatasetType</span></code> (<a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.metadata.html#nexusLIMS.schemas.metadata.ImageMetadata" title="nexusLIMS.schemas.metadata.ImageMetadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageMetadata</span></code></a>,
<a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.metadata.html#nexusLIMS.schemas.metadata.SpectrumMetadata" title="nexusLIMS.schemas.metadata.SpectrumMetadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpectrumMetadata</span></code></a>, etc.)</p></li>
<li><p><strong>Required fields</strong>: <code class="docutils literal notranslate"><span class="pre">creation_time</span></code> (with timezone), <code class="docutils literal notranslate"><span class="pre">data_type</span></code>, <code class="docutils literal notranslate"><span class="pre">dataset_type</span></code></p></li>
<li><p><strong>Normalization</strong>: EM Glossary terms (where available), unit standardization (voltages → kV, distances → nm/mm)</p></li>
<li><p><strong>Type safety</strong>: Invalid types, missing timezones, incorrect enums trigger logged errors</p></li>
</ol>
<p>This evolving system provides foundational standardization. See
<a class="reference internal" href="../dev_guide/nexuslims_internal_schema.html"><span class="doc">Internal Metadata Schema System</span></a> for details.</p>
<p><strong>XML serialization:</strong> Nested <code class="docutils literal notranslate"><span class="pre">'nx_meta'</span></code> structures are flattened (space-separated keys).
Most key-value pairs become <code class="docutils literal notranslate"><span class="pre">Setup</span> <span class="pre">Parameters</span></code> or <code class="docutils literal notranslate"><span class="pre">Dataset</span> <span class="pre">Metadata</span></code> in the CDCS front-end.</p>
<div class="tip admonition">
<p class="admonition-title">Special metadata keys</p>
<p>Reserved <code class="docutils literal notranslate"><span class="pre">'nx_meta'</span></code> keys with special handling:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">DatasetType</span></code></strong>: Controlled vocabulary mapped to <code class="docutils literal notranslate"><span class="pre">&lt;dataset</span> <span class="pre">&#64;type&gt;</span></code> (Image, Spectrum, etc.)</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Type</span></code></strong>: Human-readable descriptor (<code class="docutils literal notranslate"><span class="pre">TEM_Imaging</span></code>, <code class="docutils literal notranslate"><span class="pre">SEM_EDS</span></code>, <code class="docutils literal notranslate"><span class="pre">STEM_EELS</span></code>) for activity contents summary</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">Creation</span> <span class="pre">Time</span></code></strong>: <a class="reference external" href="https://en.wikipedia.org/wiki/ISO_8601#Combined_date_and_time_representations">ISO-8601 timestamp</a> displayed in dataset table</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">Extraction</span> <span class="pre">Details</span></code></strong>: Metadata extraction provenance information</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">warnings</span></code></strong>: List of unreliable metadata keys (front-end displays warnings)</p></li>
</ul>
<p>See <a class="reference internal" href="../dev_guide/nexuslims_internal_schema.html"><span class="doc">Internal Metadata Schema System</span></a> for complete metadata schema documentation.</p>
</div>
<p><strong>Extractor implementation:</strong> Extractors leverage <a class="reference external" href="https://hyperspy.org/">HyperSpy</a> for most
formats. Unsupported formats require manual binary decoding and custom extractor/preview
generator implementation.</p>
<p><strong>Output artifacts:</strong> <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.extractors.html#nexusLIMS.extractors.parse_metadata" title="nexusLIMS.extractors.parse_metadata"><code class="xref py py-func docutils literal notranslate"><span class="pre">parse_metadata()</span></code></a> generates (saved to
<a class="reference internal" href="configuration.html#config-data-path"><span class="std std-ref">NX_DATA_PATH</span></a>, mirroring <a class="reference internal" href="configuration.html#config-instrument-data-path"><span class="std std-ref">NX_INSTRUMENT_DATA_PATH</span></a> structure):</p>
<ul class="simple">
<li><p><strong>JSON metadata file</strong>: Full metadata in text format (linked from XML record)</p></li>
<li><p><strong>PNG preview image</strong>: Generated via <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.extractors.plugins.preview_generators.html#module-nexusLIMS.extractors.plugins.preview_generators" title="nexusLIMS.extractors.plugins.preview_generators"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nexusLIMS.extractors.plugins.preview_generators</span></code></a>
(HyperSpy-based for complex formats, simple downsampling for TIFF)</p></li>
</ul>
<p>Metadata and preview paths are stored at the
<a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.activity.html#nexusLIMS.schemas.activity.AcquisitionActivity" title="nexusLIMS.schemas.activity.AcquisitionActivity"><code class="xref py py-class docutils literal notranslate"><span class="pre">AcquisitionActivity</span></code></a> level.</p>
<p><a class="reference internal" href="#overview"><span class="std std-ref">(go to top)</span></a></p>
</section>
<section id="determining-setup-parameters">
<span id="separate-setup-parameters"></span><h3>6. Determining Setup Parameters<a class="headerlink" href="#determining-setup-parameters" title="Link to this heading">#</a></h3>
<p>After file processing, metadata is organized hierarchically:</p>
<ul class="simple">
<li><p><strong>Common values</strong> (identical across all activity files) → <code class="docutils literal notranslate"><span class="pre">&lt;AcquisitionActivity&gt;</span></code> Setup Parameters</p></li>
<li><p><strong>Unique values</strong> (varying per file) → <code class="docutils literal notranslate"><span class="pre">&lt;dataset&gt;</span></code> metadata</p></li>
</ul>
<p><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.activity.html#nexusLIMS.schemas.activity.AcquisitionActivity.store_setup_params" title="nexusLIMS.schemas.activity.AcquisitionActivity.store_setup_params"><code class="xref py py-meth docutils literal notranslate"><span class="pre">store_setup_params()</span></code></a> identifies
common metadata by comparing values across files.
<a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.activity.html#nexusLIMS.schemas.activity.AcquisitionActivity.store_unique_metadata" title="nexusLIMS.schemas.activity.AcquisitionActivity.store_unique_metadata"><code class="xref py py-meth docutils literal notranslate"><span class="pre">store_unique_metadata()</span></code></a> then
stores only file-specific values at the dataset level.</p>
<p>This organization helps users distinguish constant experimental conditions from
per-file variations.</p>
<p><a class="reference internal" href="#overview"><span class="std std-ref">(go to top)</span></a></p>
</section>
<section id="validating-the-built-records">
<span id="validating-the-record"></span><h3>7. Validating the Built Records<a class="headerlink" href="#validating-the-built-records" title="Link to this heading">#</a></h3>
<p>Each completed <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.activity.html#nexusLIMS.schemas.activity.AcquisitionActivity" title="nexusLIMS.schemas.activity.AcquisitionActivity"><code class="xref py py-class docutils literal notranslate"><span class="pre">AcquisitionActivity</span></code></a> is converted
to XML via <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.activity.html#nexusLIMS.schemas.activity.AcquisitionActivity.as_xml" title="nexusLIMS.schemas.activity.AcquisitionActivity.as_xml"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_xml()</span></code></a>. Once all
activities are assembled, <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.builder.record_builder.html#nexusLIMS.builder.record_builder.validate_record" title="nexusLIMS.builder.record_builder.validate_record"><code class="xref py py-func docutils literal notranslate"><span class="pre">validate_record()</span></code></a>
validates the complete record against the NexusLIMS schema.</p>
<p><strong>Validation failure:</strong> Session marked <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> in database for investigation.</p>
<p><strong>Validation success:</strong> Record written to <a class="reference internal" href="configuration.html#config-records-path"><span class="std std-ref">NX_RECORDS_PATH</span></a>
(or <a class="reference internal" href="configuration.html#config-data-path"><span class="std std-ref">NX_DATA_PATH</span></a> subdirectory if unspecified) before CDCS upload.</p>
<p>The builder then processes the next session, repeating until all are complete.</p>
<p><a class="reference internal" href="#overview"><span class="std std-ref">(go to top)</span></a></p>
</section>
<section id="uploading-completed-records-and-updating-database">
<span id="upload-records"></span><h3>8. Uploading Completed Records and Updating Database<a class="headerlink" href="#uploading-completed-records-and-updating-database" title="Link to this heading">#</a></h3>
<p>After all sessions are processed, <a class="reference internal" href="../api/nexusLIMS/nexusLIMS.cdcs.html#nexusLIMS.cdcs.upload_record_files" title="nexusLIMS.cdcs.upload_record_files"><code class="xref py py-func docutils literal notranslate"><span class="pre">upload_record_files()</span></code></a>
uploads generated XML records to the CDCS instance via the
<a class="reference external" href="https://cdcs.nist.gov/cdcs-documentation/18-rest-api-examples.html">CDCS REST API</a>.</p>
<p><strong>Upload process:</strong></p>
<ol class="arabic simple">
<li><p>CDCS re-validates each record against the NexusLIMS schema</p></li>
<li><p>Records are assigned to the <code class="docutils literal notranslate"><span class="pre">Global</span> <span class="pre">Public</span> <span class="pre">Workspace</span></code> (viewable without login)</p></li>
<li><p>Database is updated with upload status</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Future versions will implement single-sign-on, assigning records to their creating users
instead of the public workspace.</p>
</div>
<p>The complete workflow repeats periodically (see <a class="reference internal" href="#general-approach"><span class="std std-ref">General Approach</span></a>)
to process new sessions as they occur.</p>
<p><a class="reference internal" href="#overview"><span class="std std-ref">(go to top)</span></a></p>
</section>
</section>
<section id="record-generation-diagram">
<span id="activity-diagram"></span><h2>Record Generation Diagram<a class="headerlink" href="#record-generation-diagram" title="Link to this heading">#</a></h2>
<p>The following diagram illustrates the logic (described above) that is used to
generate <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> records and upload them to the NexusLIMS CDCS instance.</p>
<p>The diagram shows the flow through different modules/sub-packages within the
<code class="docutils literal notranslate"><span class="pre">nexusLIMS</span></code> package. Decision points determine the path through the workflow,
and database updates occur at key stages to track session status.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>💡 <strong>Interactive Diagram</strong>: You can zoom in/out (scroll or pinch) and pan (click and drag) to explore different parts of the workflow in detail.</p>
</div>
<pre  class="mermaid">
        %%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#eee', 'primaryTextColor': '#000', 'primaryBorderColor': '#333', 'lineColor': '#333', 'secondaryColor': '#eeeeff', 'tertiaryColor': '#eeffee', 'noteBkgColor': '#fff9e6', 'noteBorderColor': '#d4a017'}}}%%
flowchart TD
    Start([Start]) --&gt; ProcessNewSessions[&quot;record_builder.process_new_sessions()&quot;]

    ProcessNewSessions --&gt; AddUsageEvents[&quot;harvesters.nemo.add_all_usage_events_to_db()&quot;]

    AddUsageEvents --&gt; GetSessions[&quot;session_handler.get_sessions_to_build()&quot;]

    GetSessions --&gt; CheckSessions{New sessions&lt;br/&gt;found?}
    CheckSessions --&gt;|No| End1([End])
    CheckSessions --&gt;|Yes| ExtractSession[&quot;Extract single Session&quot;]

    ExtractSession --&gt; ReturnSession[&quot;Return session_handler.Session object&quot;]
    ReturnSession --&gt; InsertEvent[&quot;Insert RECORD_GENERATION event&lt;br/&gt;in database&quot;]
    InsertEvent --&gt; BuildRecord[&quot;record_builder.build_record(Session)&quot;]

    BuildRecord --&gt; CreateXML[&quot;Create new .xml document&lt;br/&gt;for this Experiment&quot;]
    CreateXML --&gt; FindReservation[&quot;harvesters.XXXX.res_event_from_session(s)&quot;]

    FindReservation --&gt; CheckReservation{ReservationEvent&lt;br/&gt;found?}
    CheckReservation --&gt;|Yes| AddDetailedInfo[&quot;Add detailed event info&lt;br/&gt;to record summary XML&quot;]
    CheckReservation --&gt;|No| AddBasicInfo[&quot;Add basic information&lt;br/&gt;(instrument and date)&quot;]
    CheckReservation --&gt;|No consent| UpdateNoConsent[&quot;Update Session status&lt;br/&gt;as NO_CONSENT&quot;]
    CheckReservation --&gt;|No reservation| UpdateNoReservation[&quot;Update Session status&lt;br/&gt;as NO_RESERVATION&quot;]

    AddDetailedInfo --&gt; IdentifyFiles
    AddBasicInfo --&gt; IdentifyFiles[&quot;Identify files created on this&lt;br/&gt;instrument within timespan&quot;]

    IdentifyFiles --&gt; CheckFiles{Files found?}
    CheckFiles --&gt;|No| UpdateNoFiles[&quot;Update Session status&lt;br/&gt;as NO_FILES_FOUND&quot;]
    CheckFiles --&gt;|Yes| ClusterFiles[&quot;Separate files into activities&lt;br/&gt;by clustering file creation times&quot;]

    ClusterFiles --&gt; ProcessActivity[&quot;Build one AcquisitionActivity&quot;]
    ProcessActivity --&gt; ParseMetadata[&quot;Parse metadata for all files&quot;]

    ParseMetadata --&gt; ExtractLoop[&quot;extractors.parse_metadata(filename)&quot;]
    ExtractLoop --&gt; ExtractMetadata[&quot;Extract metadata from file&quot;]
    ExtractMetadata --&gt; DetermineType[&quot;Determine dataset type&quot;]
    DetermineType --&gt; ValidateMetadata[&quot;Validate metadata using&lt;br/&gt;Pydantic schemas&quot;]
    ValidateMetadata --&gt; GeneratePreview[&quot;Generate .png preview image&quot;]
    GeneratePreview --&gt; SaveMetadata[&quot;Save metadata as .json&quot;]

    SaveMetadata --&gt; CheckMoreFiles{More files&lt;br/&gt;to process?}
    CheckMoreFiles --&gt;|Yes| ExtractLoop
    CheckMoreFiles --&gt;|No| AssignMetadata[&quot;Assign common metadata as&lt;br/&gt;Setup parameters and&lt;br/&gt;unique metadata to datasets&quot;]

    AssignMetadata --&gt; AddActivity[&quot;Add AcquisitionActivity&lt;br/&gt;to .xml record&quot;]
    AddActivity --&gt; CheckMoreActivities{More activities&lt;br/&gt;to process?}
    CheckMoreActivities --&gt;|Yes| ProcessActivity
    CheckMoreActivities --&gt;|No| ValidateRecord{Validate&lt;br/&gt;record?}

    ValidateRecord --&gt;|Valid| WriteXML[&quot;Write XML record&lt;br/&gt;to NexusLIMS folder&quot;]
    ValidateRecord --&gt;|Invalid| UpdateError[&quot;Update Session status&lt;br/&gt;as ERROR&quot;]

    WriteXML --&gt; UpdateCompleted[&quot;Update Session status&lt;br/&gt;as COMPLETED&quot;]

    UpdateCompleted --&gt; VerifyUpdate[&quot;Verify Session was updated&lt;br/&gt;in database&quot;]
    UpdateError --&gt; VerifyUpdate
    UpdateNoFiles --&gt; VerifyUpdate
    UpdateNoConsent --&gt; VerifyUpdate
    UpdateNoReservation --&gt; VerifyUpdate

    VerifyUpdate --&gt; CheckMoreSessions{More sessions&lt;br/&gt;to process?}
    CheckMoreSessions --&gt;|Yes| ExtractSession
    CheckMoreSessions --&gt;|No| CheckRecordsCreated{Any records&lt;br/&gt;created?}

    CheckRecordsCreated --&gt;|No| End2([End])
    CheckRecordsCreated --&gt;|Yes| UploadRecord[&quot;Upload single .xml record&quot;]

    UploadRecord --&gt; AssignWorkspace[&quot;Assign to public&lt;br/&gt;CDCS workspace&quot;]
    AssignWorkspace --&gt; CheckMoreRecords{More records&lt;br/&gt;to upload?}
    CheckMoreRecords --&gt;|Yes| UploadRecord
    CheckMoreRecords --&gt;|No| End3([End])

    %% Styling
    classDef recordBuilder fill:#eee,stroke:#333,stroke-width:2px
    classDef sessionHandler fill:#eeeeff,stroke:#333,stroke-width:2px
    classDef extractors fill:#eeffee,stroke:#333,stroke-width:2px
    classDef cdcs fill:#ffefe1,stroke:#333,stroke-width:2px
    classDef dbUpdate fill:#ffcc99,stroke:#333,stroke-width:3px

    class ProcessNewSessions,BuildRecord,CreateXML,IdentifyFiles,ClusterFiles,ProcessActivity,AssignMetadata,AddActivity,ValidateRecord,WriteXML recordBuilder
    class AddUsageEvents,GetSessions,ReturnSession,InsertEvent,VerifyUpdate sessionHandler
    class ParseMetadata,ExtractLoop,ExtractMetadata,DetermineType,ValidateMetadata,GeneratePreview,SaveMetadata extractors
    class UploadRecord,AssignWorkspace cdcs
    class UpdateCompleted,UpdateError,UpdateNoFiles,UpdateNoConsent,UpdateNoReservation dbUpdate
    </pre><p><strong>Diagram Key:</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Module</p></th>
<th class="head"><p>Light Mode</p></th>
<th class="head"><p>Dark Mode</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Record Builder</p></td>
<td><p>Gray boxes</p></td>
<td><p>Dark gray boxes</p></td>
</tr>
<tr class="row-odd"><td><p>Session Handler</p></td>
<td><p>Light blue boxes</p></td>
<td><p>Dark yellow boxes</p></td>
</tr>
<tr class="row-even"><td><p>Metadata Extractors</p></td>
<td><p>Light green boxes</p></td>
<td><p>Red boxes</p></td>
</tr>
<tr class="row-odd"><td><p>CDCS Connector</p></td>
<td><p>Peach boxes</p></td>
<td><p>Slate gray boxes</p></td>
</tr>
<tr class="row-even"><td><p>Database Updates</p></td>
<td><p>Orange boxes</p></td>
<td><p>Light blue boxes</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="configuration.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Configuration</p>
      </div>
    </a>
    <a class="right-next"
       href="extractors.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Extractors</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-approach">General Approach</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-new-sessions">Finding New Sessions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-a-single-record">Building a Single Record</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#record-generation-diagram">Record Generation Diagram</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user_guide/record_building.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025 - 2026, datasophos, LLC.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>