
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Writing Extractor Plugins &#8212; NexusLIMS dev documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=acda69ee" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=3ce10a4d"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=30646c52"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'dev_guide/writing_extractor_plugins';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = '_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            true;
        </script>
    <script src="../_static/custom.js?v=ba087cdf"></script>
    <link rel="canonical" href="https://datasophos.github.io/NexusLIMS/latest/dev_guide/writing_extractor_plugins.html" />
    <link rel="icon" href="../_static/nexusLIMS_bare_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Writing Export Destination Plugins" href="writing_export_destinations.html" />
    <link rel="prev" title="Development introduction" href="development.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="dev" />
    <meta name="docbuild:last-update" content="Feb, 08, 2026"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_horizontal_light.png" class="logo__image only-light" alt="NexusLIMS dev documentation - Home"/>
    <img src="../_static/logo_horizontal_dark.png" class="logo__image only-dark pst-js-only" alt="NexusLIMS dev documentation - Home"/>
  
  
</a></div>
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    Home
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../migration_guide.html">
    Migration Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../dev_guide.html">
    Dev Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../frontend_guide.html">
    Frontend Guide
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../reference.html">
    Reference
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/datasophos/NexusLIMS" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://datasophos.co" title="Datasophos" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-globe fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Datasophos</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    Home
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../migration_guide.html">
    Migration Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../dev_guide.html">
    Dev Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../frontend_guide.html">
    Frontend Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/datasophos/NexusLIMS" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://datasophos.co" title="Datasophos" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-globe fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Datasophos</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="development.html">Development introduction</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Writing Extractor Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_export_destinations.html">Writing Export Destination Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrument_profiles.html">Instrument Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="nexuslims_internal_schema.html">Internal Metadata Schema System</a></li>
<li class="toctree-l1"><a class="reference internal" href="em_glossary_reference.html">EM Glossary Field Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="uv_migration.html">Migration from Poetry to uv</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">NexusLIMS Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema_documentation.html">XML Schema Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing/integration-tests.html">Integration Testing Guide</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../dev_guide.html" class="nav-link">Dev Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Writing Extractor Plugins</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="writing-extractor-plugins">
<h1>Writing Extractor Plugins<a class="headerlink" href="#writing-extractor-plugins" title="Link to this heading">#</a></h1>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 2.1.0.</span></p>
</div>
<p>This guide explains how to create custom metadata extractors for NexusLIMS using the plugin-based system introduced in v2.1.0.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>NexusLIMS uses a plugin-based architecture for metadata extraction. Extractors are automatically discovered from the <code class="docutils literal notranslate"><span class="pre">nexusLIMS/extractors/plugins/</span></code> directory and registered based on their file type support and priority.</p>
</section>
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Link to this heading">#</a></h2>
<p>To create a new extractor plugin:</p>
<ol class="arabic simple">
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">.py</span></code> file in <code class="docutils literal notranslate"><span class="pre">nexusLIMS/extractors/plugins/</span></code></p></li>
<li><p>Define a class with the required interface (see below)</p></li>
<li><p>That’s it! The registry will automatically discover and use your extractor</p></li>
</ol>
</section>
<section id="minimal-example">
<h2>Minimal Example<a class="headerlink" href="#minimal-example" title="Link to this heading">#</a></h2>
<p>Here’s a minimal extractor for a hypothetical <code class="docutils literal notranslate"><span class="pre">.xyz</span></code> file format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;XYZ file format extractor plugin.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.extractors.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExtractionContext</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">XYZExtractor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extractor for XYZ format files.&quot;&quot;&quot;</span>
    
    <span class="c1"># Required class attributes</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;xyz_extractor&quot;</span>  <span class="c1"># Unique identifier</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Higher = preferred (0-1000)</span>
    <span class="n">supported_extensions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xyz&quot;</span><span class="p">}</span>  <span class="c1"># Extensions this extractor supports</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">supports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExtractionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if this extractor supports the given file.</span>

<span class="sd">        Can check file extension and/or file contents (content-sniffing).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        context : ExtractionContext</span>
<span class="sd">            Contains file_path and instrument information</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if this extractor can handle the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="o">!=</span> <span class="s2">&quot;xyz&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Optional: Check file contents for format signature</span>
        <span class="c1"># with open(context.file_path, &quot;rb&quot;) as f:</span>
        <span class="c1">#     header = f.read(8)</span>
        <span class="c1">#     return header.startswith(b&quot;XYZDATA&quot;)</span>

        <span class="k">return</span> <span class="kc">True</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExtractionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract metadata from an XYZ file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        context : ExtractionContext</span>
<span class="sd">            Contains file_path and instrument information</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[dict]</span>
<span class="sd">            List of metadata dictionaries, one per signal.</span>
<span class="sd">            Each dict has an &#39;nx_meta&#39; key with NexusLIMS metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Extracting metadata from XYZ file: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>

        <span class="c1"># Your extraction logic here</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nx_meta&quot;</span><span class="p">:</span> <span class="p">{}}</span>

        <span class="c1"># Add required fields</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;nx_meta&quot;</span><span class="p">][</span><span class="s2">&quot;DatasetType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Image&quot;</span>  <span class="c1"># or &quot;Spectrum&quot;, &quot;SpectrumImage&quot;, etc.</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;nx_meta&quot;</span><span class="p">][</span><span class="s2">&quot;Data Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SEM_Imaging&quot;</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;nx_meta&quot;</span><span class="p">][</span><span class="s2">&quot;Creation Time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_creation_time</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>

        <span class="c1"># Add format-specific metadata</span>
        <span class="c1"># ...</span>

        <span class="c1"># Always return a list (even for single-signal files)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">metadata</span><span class="p">]</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_creation_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to get ISO-formatted creation time.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.instruments</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_instr_from_filepath</span>
        
        <span class="n">mtime</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span>
        <span class="n">instr</span> <span class="o">=</span> <span class="n">get_instr_from_filepath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span>
            <span class="n">mtime</span><span class="p">,</span>
            <span class="n">tz</span><span class="o">=</span><span class="n">instr</span><span class="o">.</span><span class="n">timezone</span> <span class="k">if</span> <span class="n">instr</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="required-interface">
<h2>Required Interface<a class="headerlink" href="#required-interface" title="Link to this heading">#</a></h2>
<p>Every extractor plugin must define a class with these attributes and methods:</p>
<section id="class-attributes">
<h3>Class Attributes<a class="headerlink" href="#class-attributes" title="Link to this heading">#</a></h3>
<section id="name-str">
<h4><code class="docutils literal notranslate"><span class="pre">name:</span> <span class="pre">str</span></code><a class="headerlink" href="#name-str" title="Link to this heading">#</a></h4>
<p>Unique identifier for this extractor. Use lowercase with underscores (e.g., <code class="docutils literal notranslate"><span class="pre">&quot;dm3_extractor&quot;</span></code>).</p>
</section>
<section id="priority-int">
<h4><code class="docutils literal notranslate"><span class="pre">priority:</span> <span class="pre">int</span></code><a class="headerlink" href="#priority-int" title="Link to this heading">#</a></h4>
<p>Priority for extractor selection (0-1000). Higher values are preferred. Guidelines:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">100</span></code>: Standard format-specific extractors</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">50</span></code>: Generic extractors with content sniffing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code>: Fallback extractors (like BasicFileInfoExtractor)</p></li>
</ul>
</section>
<section id="supported-extensions-set-str-none">
<h4><code class="docutils literal notranslate"><span class="pre">supported_extensions:</span> <span class="pre">set[str]</span> <span class="pre">|</span> <span class="pre">None</span></code><a class="headerlink" href="#supported-extensions-set-str-none" title="Link to this heading">#</a></h4>
<p>File extensions this extractor supports (without leading dot). Required attribute.</p>
<p><strong>Behavior:</strong></p>
<ul class="simple">
<li><p>If a <code class="docutils literal notranslate"><span class="pre">set</span></code> of extensions (e.g., <code class="docutils literal notranslate"><span class="pre">{&quot;dm3&quot;,</span> <span class="pre">&quot;dm4&quot;}</span></code>): Extractor is registered only for those extensions. The registry will prioritize this extractor when files with these extensions are encountered.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">None</span></code>: Extractor becomes a “wildcard” extractor tried only after all extension-specific extractors fail.</p></li>
</ul>
<p><strong>Note:</strong> The registry uses this attribute to determine registration, so <code class="docutils literal notranslate"><span class="pre">supports()</span></code> should match the declared extensions. Mismatches can lead to unexpected behavior.</p>
<p><strong>Examples:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Single extension</span>
<span class="n">supported_extensions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xyz&quot;</span><span class="p">}</span>

<span class="c1"># Multiple extensions</span>
<span class="n">supported_extensions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dm3&quot;</span><span class="p">,</span> <span class="s2">&quot;dm4&quot;</span><span class="p">}</span>

<span class="c1"># Wildcard (fallback only)</span>
<span class="n">supported_extensions</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</section>
</section>
<section id="methods">
<h3>Methods<a class="headerlink" href="#methods" title="Link to this heading">#</a></h3>
<section id="supports-context-extractioncontext-bool">
<h4><code class="docutils literal notranslate"><span class="pre">supports(context:</span> <span class="pre">ExtractionContext)</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code><a class="headerlink" href="#supports-context-extractioncontext-bool" title="Link to this heading">#</a></h4>
<p>Determine if this extractor can handle a given file.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">context</span></code>: Contains <code class="docutils literal notranslate"><span class="pre">file_path</span></code> (Path) and <code class="docutils literal notranslate"><span class="pre">instrument</span></code> (Instrument or None)</p></li>
</ul>
<p><strong>Returns:</strong> <code class="docutils literal notranslate"><span class="pre">True</span></code> if this extractor supports the file</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Content Sniffing</strong>: While extension checks are fast, you can also inspect file contents to verify the format. This is useful when multiple formats share the same extension or when you need to distinguish file variants. See <a class="reference internal" href="#content-based-detection">Content-Based Detection</a> for advanced examples.</p>
</div>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">supports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExtractionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="c1"># Simple extension check</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;dm3&quot;</span><span class="p">,</span> <span class="s2">&quot;dm4&quot;</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="extract-context-extractioncontext-list-dict-str-any">
<h4><code class="docutils literal notranslate"><span class="pre">extract(context:</span> <span class="pre">ExtractionContext)</span> <span class="pre">-&gt;</span> <span class="pre">list[dict[str,</span> <span class="pre">Any]]</span></code><a class="headerlink" href="#extract-context-extractioncontext-list-dict-str-any" title="Link to this heading">#</a></h4>
<p>Extract metadata from the file.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">context</span></code>: Contains <code class="docutils literal notranslate"><span class="pre">file_path</span></code> (Path) and <code class="docutils literal notranslate"><span class="pre">instrument</span></code> (Instrument or None)</p></li>
</ul>
<p><strong>Returns:</strong> A <strong>list</strong> of metadata dictionaries. Each dict must contain an <code class="docutils literal notranslate"><span class="pre">&quot;nx_meta&quot;</span></code> key with NexusLIMS metadata.</p>
<p><strong>Format:</strong></p>
<ul class="simple">
<li><p>Single-signal files: Return <code class="docutils literal notranslate"><span class="pre">[{...}]</span></code> - a list with one element</p></li>
<li><p>Multi-signal files: Return <code class="docutils literal notranslate"><span class="pre">[{...},</span> <span class="pre">{...}]</span></code> - a list with multiple elements</p></li>
</ul>
<p><strong>Required <code class="docutils literal notranslate"><span class="pre">nx_meta</span></code> fields (in each dict):</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;DatasetType&quot;</span></code>: One of “Image”, “Spectrum”, “SpectrumImage”, “Diffraction”, “Misc”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;Data</span> <span class="pre">Type&quot;</span></code>: Descriptive string (e.g., “STEM_Imaging”, “TEM_EDS”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;Creation</span> <span class="pre">Time&quot;</span></code>: ISO-8601 formatted timestamp <strong>with timezone</strong> (e.g., <code class="docutils literal notranslate"><span class="pre">&quot;2024-01-15T10:30:00-05:00&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;2024-01-15T10:30:00Z&quot;</span></code>)</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExtractionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nx_meta&quot;</span><span class="p">:</span> <span class="p">{}}</span>
    <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;nx_meta&quot;</span><span class="p">][</span><span class="s2">&quot;DatasetType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Image&quot;</span>
    <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;nx_meta&quot;</span><span class="p">][</span><span class="s2">&quot;Data Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SEM_Imaging&quot;</span>
    <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;nx_meta&quot;</span><span class="p">][</span><span class="s2">&quot;Creation Time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2024-01-15T10:30:00-05:00&quot;</span>
    <span class="c1"># ... extraction logic</span>
    <span class="c1"># Always return a list</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">metadata</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="metadata-validation">
<span id="id1"></span><h4>Metadata Validation<a class="headerlink" href="#metadata-validation" title="Link to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">nx_meta</span></code> section is automatically validated using <strong>type-specific</strong> Pydantic schemas based on the <code class="docutils literal notranslate"><span class="pre">DatasetType</span></code> field. NexusLIMS provides schema classes for each dataset type:</p>
<ul class="simple">
<li><p><strong><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.metadata.html#nexusLIMS.schemas.metadata.ImageMetadata" title="nexusLIMS.schemas.metadata.ImageMetadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">nexusLIMS.schemas.metadata.ImageMetadata</span></code></a></strong> - For Image datasets</p>
<ul>
<li><p>Validates imaging-specific fields (acceleration_voltage, working_distance, beam_current, etc.)</p></li>
<li><p>Used when <code class="docutils literal notranslate"><span class="pre">DatasetType</span> <span class="pre">==</span> <span class="pre">&quot;Image&quot;</span></code></p></li>
</ul>
</li>
<li><p><strong><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.metadata.html#nexusLIMS.schemas.metadata.SpectrumMetadata" title="nexusLIMS.schemas.metadata.SpectrumMetadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">nexusLIMS.schemas.metadata.SpectrumMetadata</span></code></a></strong> - For Spectrum datasets</p>
<ul>
<li><p>Validates spectrum-specific fields (acquisition_time, live_time, channel_size, etc.)</p></li>
<li><p>Used when <code class="docutils literal notranslate"><span class="pre">DatasetType</span> <span class="pre">==</span> <span class="pre">&quot;Spectrum&quot;</span></code></p></li>
</ul>
</li>
<li><p><strong><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.metadata.html#nexusLIMS.schemas.metadata.SpectrumImageMetadata" title="nexusLIMS.schemas.metadata.SpectrumImageMetadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">nexusLIMS.schemas.metadata.SpectrumImageMetadata</span></code></a></strong> - For SpectrumImage datasets</p>
<ul>
<li><p>Combines both Image and Spectrum field validation</p></li>
<li><p>Used when <code class="docutils literal notranslate"><span class="pre">DatasetType</span> <span class="pre">==</span> <span class="pre">&quot;SpectrumImage&quot;</span></code></p></li>
</ul>
</li>
<li><p><strong><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.metadata.html#nexusLIMS.schemas.metadata.DiffractionMetadata" title="nexusLIMS.schemas.metadata.DiffractionMetadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">nexusLIMS.schemas.metadata.DiffractionMetadata</span></code></a></strong> - For Diffraction datasets</p>
<ul>
<li><p>Validates diffraction-specific fields (camera_length, convergence_angle, etc.)</p></li>
<li><p>Used when <code class="docutils literal notranslate"><span class="pre">DatasetType</span> <span class="pre">==</span> <span class="pre">&quot;Diffraction&quot;</span></code></p></li>
</ul>
</li>
<li><p><strong><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.schemas.metadata.html#nexusLIMS.schemas.metadata.NexusMetadata" title="nexusLIMS.schemas.metadata.NexusMetadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">nexusLIMS.schemas.metadata.NexusMetadata</span></code></a></strong> - Base schema</p>
<ul>
<li><p>Used for <code class="docutils literal notranslate"><span class="pre">DatasetType</span> <span class="pre">==</span> <span class="pre">&quot;Misc&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;Unknown&quot;</span></code></p></li>
<li><p>Validates only common required fields</p></li>
</ul>
</li>
</ul>
<p><strong>Validation Process:</strong></p>
<ol class="arabic simple">
<li><p>Extractor sets <code class="docutils literal notranslate"><span class="pre">DatasetType</span></code> field in <code class="docutils literal notranslate"><span class="pre">nx_meta</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validate_nx_meta()</span></code> selects appropriate schema based on <code class="docutils literal notranslate"><span class="pre">DatasetType</span></code></p></li>
<li><p>Schema validates both required fields and type-specific optional fields</p></li>
<li><p>Validation errors include detailed field-level diagnostics</p></li>
<li><p><strong>Strict validation</strong> - invalid metadata causes extraction to fail</p></li>
</ol>
<p>All schemas support the <code class="docutils literal notranslate"><span class="pre">extensions</span></code> section for instrument-specific metadata that doesn’t fit the core schema (see “Core Fields vs. Extensions” below).</p>
<p id="schema-selection-logic"><strong>Schema Selection Logic</strong></p>
<p>When writing an extractor, choose the appropriate <code class="docutils literal notranslate"><span class="pre">DatasetType</span></code> based on the data content:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>DatasetType</p></th>
<th class="head"><p>When to Use</p></th>
<th class="head"><p>Example Data</p></th>
<th class="head"><p>Schema Used</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;Image&quot;</span></code></p></td>
<td><p>2D imaging data (SEM, TEM, STEM images)</p></td>
<td><p>Micrographs, detector images</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ImageMetadata</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;Spectrum&quot;</span></code></p></td>
<td><p>1D spectral data (EDS, EELS point spectra)</p></td>
<td><p>Single-point spectrum</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SpectrumMetadata</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;SpectrumImage&quot;</span></code></p></td>
<td><p>2D image with spectrum at each pixel</p></td>
<td><p>EDS maps, EELS spectrum images</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SpectrumImageMetadata</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;Diffraction&quot;</span></code></p></td>
<td><p>Diffraction patterns (SAED, CBED, 4D-STEM)</p></td>
<td><p>Diffraction patterns, 4D datasets</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DiffractionMetadata</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;Misc&quot;</span></code></p></td>
<td><p>Other data types</p></td>
<td><p>Proprietary formats, unusual data</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NexusMetadata</span></code> (base)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;Unknown&quot;</span></code></p></td>
<td><p>Unable to determine type</p></td>
<td><p>Unreadable files, fallback</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NexusMetadata</span></code> (base)</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Common extraction patterns:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># SEM image</span>
<span class="n">nx_meta</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;DatasetType&quot;</span><span class="p">:</span> <span class="s2">&quot;Image&quot;</span><span class="p">,</span>  <span class="c1"># → validates with ImageMetadata</span>
    <span class="s2">&quot;Data Type&quot;</span><span class="p">:</span> <span class="s2">&quot;SEM_Imaging&quot;</span><span class="p">,</span>
    <span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;kilovolt&quot;</span><span class="p">),</span>
    <span class="s2">&quot;working_distance&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">5.2</span><span class="p">,</span> <span class="s2">&quot;millimeter&quot;</span><span class="p">),</span>
    <span class="c1"># ... imaging-specific fields</span>
<span class="p">}</span>

<span class="c1"># EDS spectrum</span>
<span class="n">nx_meta</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;DatasetType&quot;</span><span class="p">:</span> <span class="s2">&quot;Spectrum&quot;</span><span class="p">,</span>  <span class="c1"># → validates with SpectrumMetadata</span>
    <span class="s2">&quot;Data Type&quot;</span><span class="p">:</span> <span class="s2">&quot;SEM_EDS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;acquisition_time&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;second&quot;</span><span class="p">),</span>
    <span class="s2">&quot;live_time&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">58.5</span><span class="p">,</span> <span class="s2">&quot;second&quot;</span><span class="p">),</span>
    <span class="s2">&quot;channel_size&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;electronvolt&quot;</span><span class="p">),</span>
    <span class="c1"># ... spectrum-specific fields</span>
<span class="p">}</span>

<span class="c1"># EDS map (spectrum at each pixel)</span>
<span class="n">nx_meta</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;DatasetType&quot;</span><span class="p">:</span> <span class="s2">&quot;SpectrumImage&quot;</span><span class="p">,</span>  <span class="c1"># → validates with SpectrumImageMetadata</span>
    <span class="s2">&quot;Data Type&quot;</span><span class="p">:</span> <span class="s2">&quot;STEM_EDS&quot;</span><span class="p">,</span>
    <span class="c1"># Validates BOTH imaging and spectrum fields</span>
    <span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;kilovolt&quot;</span><span class="p">),</span>
    <span class="s2">&quot;acquisition_time&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;second&quot;</span><span class="p">),</span>
    <span class="c1"># ... combined fields</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Tip:</strong> If unsure about <code class="docutils literal notranslate"><span class="pre">DatasetType</span></code>, examine the data shape:</p>
<ul class="simple">
<li><p>Single 2D array → likely <code class="docutils literal notranslate"><span class="pre">&quot;Image&quot;</span></code></p></li>
<li><p>Single 1D array with energy axis → likely <code class="docutils literal notranslate"><span class="pre">&quot;Spectrum&quot;</span></code></p></li>
<li><p>3D array (x, y, spectrum) → likely <code class="docutils literal notranslate"><span class="pre">&quot;SpectrumImage&quot;</span></code></p></li>
<li><p>2D array with reciprocal space metadata → likely <code class="docutils literal notranslate"><span class="pre">&quot;Diffraction&quot;</span></code></p></li>
</ul>
<p>For more details on validation and schema structure, see <a class="reference internal" href="nexuslims_internal_schema.html"><span class="std std-doc">NexusLIMS Internal Schema</span></a>.</p>
</section>
<section id="using-pint-quantities-for-physical-values">
<span id="using-pint-quantities"></span><h4>Using Pint Quantities for Physical Values<a class="headerlink" href="#using-pint-quantities-for-physical-values" title="Link to this heading">#</a></h4>
<p><strong>Since v2.2.0</strong>, NexusLIMS uses <strong>Pint Quantities</strong> for all fields with physical units. This provides:</p>
<ul class="simple">
<li><p>Type safety and automatic unit validation</p></li>
<li><p>Programmatic unit conversion</p></li>
<li><p>Machine-readable unit information</p></li>
<li><p>Standardized field names using EM Glossary terminology</p></li>
</ul>
<p><strong>Example with Pint Quantities:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the NexusLIMS unit registry</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.schemas.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">ureg</span>

<span class="c1"># Create Pint Quantity objects for fields with units</span>
<span class="n">nx_meta</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;DatasetType&quot;</span><span class="p">:</span> <span class="s2">&quot;Image&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Data Type&quot;</span><span class="p">:</span> <span class="s2">&quot;SEM_Imaging&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Creation Time&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-15T10:30:00-05:00&quot;</span><span class="p">,</span>

    <span class="c1"># Physical quantities with units (using Pint)</span>
    <span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;kilovolt&quot;</span><span class="p">),</span>  <span class="c1"># or ureg(&quot;15 kV&quot;)</span>
    <span class="s2">&quot;working_distance&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">5.2</span><span class="p">,</span> <span class="s2">&quot;millimeter&quot;</span><span class="p">),</span>  <span class="c1"># or ureg(&quot;5.2 mm&quot;)</span>
    <span class="s2">&quot;beam_current&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;picoampere&quot;</span><span class="p">),</span>  <span class="c1"># or ureg(&quot;100 pA&quot;)</span>
    <span class="s2">&quot;dwell_time&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;microsecond&quot;</span><span class="p">),</span>  <span class="c1"># or ureg(&quot;10 us&quot;)</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Tip:</strong> For a complete reference of standardized field names and their preferred units, see <a class="reference internal" href="em_glossary_reference.html#field-mapping-quick-reference"><span class="std std-ref">EM Glossary Quick Reference</span></a>. When defining Pydantic schemas (not extractors), you can use <a class="reference internal" href="nexuslims_internal_schema.html#metadata-helper-functions"><span class="std std-ref">emg_field()</span></a> to automatically populate field metadata from EM Glossary.</p>
<p><strong>Converting from raw values:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.schemas.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">ureg</span>

<span class="c1"># If you have voltage in volts, create Quantity directly</span>
<span class="n">voltage_v</span> <span class="o">=</span> <span class="mi">15000</span>  <span class="c1"># Volts from file</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">voltage_v</span><span class="p">,</span> <span class="s2">&quot;volt&quot;</span><span class="p">)</span>
<span class="c1"># Pint will automatically handle unit conversion when needed</span>

<span class="c1"># Alternative: parse from string</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;working_distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span><span class="p">(</span><span class="s2">&quot;5.2 mm&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Using FieldDefinition for bulk metadata extraction:</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">FieldDefinition</span></code> pattern provides a declarative way to extract many metadata fields with minimal code repetition. This works for any file format with key-value metadata (TIFF tags, HDF5 attributes, JSON/XML metadata, etc.):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.extractors.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">FieldDefinition</span>

<span class="c1"># Define fields with their target units</span>
<span class="n">FIELD_DEFINITIONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">FieldDefinition</span><span class="p">(</span>
        <span class="n">source_key</span><span class="o">=</span><span class="s2">&quot;HV&quot;</span><span class="p">,</span>  <span class="c1"># Key in source metadata</span>
        <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">,</span>  <span class="c1"># EM Glossary field name</span>
        <span class="n">conversion_factor</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>  <span class="c1"># Convert from V to kV</span>
        <span class="n">target_unit</span><span class="o">=</span><span class="s2">&quot;kilovolt&quot;</span>  <span class="c1"># Target unit as Pint unit string</span>
    <span class="p">),</span>
    <span class="n">FieldDefinition</span><span class="p">(</span>
        <span class="n">source_key</span><span class="o">=</span><span class="s2">&quot;WD&quot;</span><span class="p">,</span>
        <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;working_distance&quot;</span><span class="p">,</span>
        <span class="n">target_unit</span><span class="o">=</span><span class="s2">&quot;millimeter&quot;</span>  <span class="c1"># No conversion if already in target units</span>
    <span class="p">),</span>
<span class="p">]</span>

<span class="c1"># In your extract() method, iterate over field definitions:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>

<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">FIELD_DEFINITIONS</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">source_key</span> <span class="ow">in</span> <span class="n">source_metadata</span><span class="p">:</span>
        <span class="n">raw_value</span> <span class="o">=</span> <span class="n">source_metadata</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">source_key</span><span class="p">]</span>

        <span class="c1"># Apply conversion factor if specified</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">conversion_factor</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raw_value</span><span class="p">))</span> <span class="o">*</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">conversion_factor</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raw_value</span><span class="p">))</span>

        <span class="c1"># IMPORTANT: Quantities MUST use Decimal, not float</span>
        <span class="c1"># This ensures precision for unit conversions</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">target_unit</span><span class="p">:</span>
            <span class="n">nx_meta</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">target_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">target_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nx_meta</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">target_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</div>
<p><strong>Real-world examples:</strong></p>
<ul class="simple">
<li><p><a class="reference download internal" download="" href="../_downloads/9aab50f0d31c81483ce18a2ba7c19905/quanta_tif.py"><span class="xref download myst">Quanta TIF extractor</span></a> - Uses <code class="docutils literal notranslate"><span class="pre">FieldDefinition</span></code> for extracting TIFF metadata tags</p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/0532b399b6fc234742d192cd1fef94ae/tescan_tif.py"><span class="xref download myst">Tescan TIF extractor</span></a> - Uses <code class="docutils literal notranslate"><span class="pre">FieldDefinition</span></code> for SEM metadata extraction</p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/6075cbe3da6e7e1ff679eb3a8eb7421f/orion_HIM_tif.py"><span class="xref download myst">Orion TIF extractor</span></a> - Uses <code class="docutils literal notranslate"><span class="pre">FieldDefinition</span></code> for HIM metadata extraction</p></li>
</ul>
<p><strong>Benefits of Pint Quantities:</strong></p>
<ol class="arabic simple">
<li><p><strong>Type safety</strong>: Invalid units are caught immediately</p></li>
<li><p><strong>Automatic conversion</strong>: Units are normalized during XML generation</p></li>
<li><p><strong>Machine-readable</strong>: Units are separate from values in XML output</p></li>
<li><p><strong>EM Glossary alignment</strong>: Field names match community standards</p></li>
</ol>
<p><strong>Important</strong>: If a field has units, <strong>always create a Pint Quantity</strong>. If a field is dimensionless (like magnification, brightness, or gain), use a plain numeric value (int/float).</p>
<p><strong>XML Output:</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- Pint Quantities serialize to clean XML with unit attributes --&gt;</span>
<span class="nt">&lt;meta</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Voltage&quot;</span><span class="w"> </span><span class="na">unit=</span><span class="s">&quot;kV&quot;</span><span class="nt">&gt;</span>15<span class="nt">&lt;/meta&gt;</span>
<span class="nt">&lt;meta</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Working Distance&quot;</span><span class="w"> </span><span class="na">unit=</span><span class="s">&quot;mm&quot;</span><span class="nt">&gt;</span>5.2<span class="nt">&lt;/meta&gt;</span>
<span class="nt">&lt;meta</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Beam Current&quot;</span><span class="w"> </span><span class="na">unit=</span><span class="s">&quot;pA&quot;</span><span class="nt">&gt;</span>100<span class="nt">&lt;/meta&gt;</span>
</pre></div>
</div>
</section>
<section id="em-glossary-field-names">
<h4>EM Glossary Field Names<a class="headerlink" href="#em-glossary-field-names" title="Link to this heading">#</a></h4>
<p>NexusLIMS uses standardized field names from the <strong>Electron Microscopy Glossary (EM Glossary)</strong> for core metadata fields. This improves interoperability and aligns with community standards.</p>
<p>For the complete field mapping (50+ fields), see the <a class="reference internal" href="em_glossary_reference.html"><span class="std std-doc">EM Glossary Reference</span></a>.</p>
<p><strong>When to use EM Glossary names:</strong></p>
<ul class="simple">
<li><p>Use EM Glossary names for <strong>core metadata fields</strong> that have standardized meanings</p></li>
<li><p>For vendor-specific or instrument-specific fields, use EM Glossary names where possible, or for fields without EM Glossary equivalents, use descriptive names.</p></li>
</ul>
</section>
<section id="core-fields-vs-extensions">
<span id="id2"></span><h4>Core Fields vs. Extensions<a class="headerlink" href="#core-fields-vs-extensions" title="Link to this heading">#</a></h4>
<p>NexusLIMS metadata follows a two-tier structure:</p>
<ol class="arabic simple">
<li><p><strong>Core fields</strong> - Standardized EM Glossary fields validated by Pydantic schemas</p></li>
<li><p><strong>Extensions</strong> - Vendor/instrument-specific fields not in the core schema</p></li>
</ol>
<p><strong>Decision guide:</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Use Core Field When…</p></th>
<th class="head"><p>Use Extension When…</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Field has EM Glossary equivalent</p></td>
<td><p>Field is vendor-specific (e.g., “fei_detector_mode”)</p></td>
</tr>
<tr class="row-odd"><td><p>Field is validated by schema</p></td>
<td><p>Field doesn’t fit any schema</p></td>
</tr>
<tr class="row-even"><td><p>Field is common across instruments</p></td>
<td><p>Field is instrument-specific metadata</p></td>
</tr>
<tr class="row-odd"><td><p>Field should be searchable/standardized</p></td>
<td><p>Field is informational only</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Example with core fields and extensions:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.schemas.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_to_extensions</span>

<span class="n">nx_meta</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Core fields (EM Glossary names) - validated by schema</span>
    <span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;kilovolt&quot;</span><span class="p">),</span>
    <span class="s2">&quot;working_distance&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">5.2</span><span class="p">,</span> <span class="s2">&quot;millimeter&quot;</span><span class="p">),</span>
    <span class="s2">&quot;beam_current&quot;</span><span class="p">:</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;picoampere&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Add vendor-specific fields to extensions using helper</span>
<span class="n">add_to_extensions</span><span class="p">(</span><span class="n">nx_meta</span><span class="p">,</span> <span class="s2">&quot;detector_brightness&quot;</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
<span class="n">add_to_extensions</span><span class="p">(</span><span class="n">nx_meta</span><span class="p">,</span> <span class="s2">&quot;facility&quot;</span><span class="p">,</span> <span class="s2">&quot;Nexus Facility&quot;</span><span class="p">)</span>
<span class="n">add_to_extensions</span><span class="p">(</span><span class="n">nx_meta</span><span class="p">,</span> <span class="s2">&quot;quanta_spot_size&quot;</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>

<span class="c1"># Result:</span>
<span class="c1"># nx_meta[&quot;extensions&quot;] = {</span>
<span class="c1">#     &quot;detector_brightness&quot;: 50.0,</span>
<span class="c1">#     &quot;facility&quot;: &quot;Nexus Facility&quot;,</span>
<span class="c1">#     &quot;quanta_spot_size&quot;: 3.5,</span>
<span class="c1"># }</span>
</pre></div>
</div>
<p>For detailed documentation, see <a class="reference internal" href="nexuslims_internal_schema.html#metadata-helper-functions"><span class="std std-ref">Helper Functions</span></a>.</p>
<p><strong>Naming conventions for extensions:</strong></p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">snake_case</span></code> for consistency with core fields</p></li>
<li><p>Add vendor prefix for vendor-specific fields (e.g., <code class="docutils literal notranslate"><span class="pre">fei_</span></code>, <code class="docutils literal notranslate"><span class="pre">zeiss_</span></code>, <code class="docutils literal notranslate"><span class="pre">quanta_</span></code>)</p></li>
<li><p>Use descriptive names (avoid abbreviations)</p></li>
<li><p>Document units in comments if applicable</p></li>
</ul>
</section>
</section>
</section>
<section id="advanced-patterns">
<h2>Advanced Patterns<a class="headerlink" href="#advanced-patterns" title="Link to this heading">#</a></h2>
<section id="content-based-detection">
<span id="id3"></span><h3>Content-Based Detection<a class="headerlink" href="#content-based-detection" title="Link to this heading">#</a></h3>
<p>For formats where extension alone isn’t sufficient:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyFormatExtractor</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;my_format_extractor&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">supported_extensions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dat&quot;</span><span class="p">}</span>  <span class="c1"># Register for .dat files</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">supports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExtractionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check file extension and validate file signature.&quot;&quot;&quot;</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">!=</span> <span class="s2">&quot;dat&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Check file signature (magic bytes)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">header</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">header</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;MYFT&quot;</span>  <span class="c1"># Your format&#39;s signature</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p><strong>Important:</strong> Keep <code class="docutils literal notranslate"><span class="pre">supported_extensions</span></code> synchronized with <code class="docutils literal notranslate"><span class="pre">supports()</span></code>. If your extractor is registered for <code class="docutils literal notranslate"><span class="pre">.dat</span></code> but <code class="docutils literal notranslate"><span class="pre">supports()</span></code> returns <code class="docutils literal notranslate"><span class="pre">False</span></code> for all <code class="docutils literal notranslate"><span class="pre">.dat</span></code> files, the registry will try other extractors.</p>
</section>
<section id="instrument-specific-extractors">
<h3>Instrument-Specific Extractors<a class="headerlink" href="#instrument-specific-extractors" title="Link to this heading">#</a></h3>
<p>Use the instrument information for instrument-specific handling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">QuantaTifExtractor</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;quanta_tif_extractor&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">150</span>  <span class="c1"># Higher priority for specific instrument</span>
    <span class="n">supported_extensions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tif&quot;</span><span class="p">}</span>  <span class="c1"># Only .tif files</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">supports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExtractionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Only support files from specific instruments.&quot;&quot;&quot;</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">!=</span> <span class="s2">&quot;tif&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Check instrument</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">instrument</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Only handle files from Quanta SEMs</span>
        <span class="k">return</span> <span class="s2">&quot;Quanta&quot;</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">instrument</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</section>
<section id="priority-guidelines">
<h3>Priority Guidelines<a class="headerlink" href="#priority-guidelines" title="Link to this heading">#</a></h3>
<p>Set appropriate priorities for your extractor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SpecificFormatExtractor</span><span class="p">:</span>
    <span class="c1"># High priority - handles specific format well</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">150</span>
    
<span class="k">class</span><span class="w"> </span><span class="nc">GenericFormatExtractor</span><span class="p">:</span>
    <span class="c1"># Medium priority - handles many formats adequately</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">75</span>
    
<span class="k">class</span><span class="w"> </span><span class="nc">FallbackExtractor</span><span class="p">:</span>
    <span class="c1"># Low/zero priority - only used when nothing else works</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
</section>
<section id="testing-your-extractor">
<h2>Testing Your Extractor<a class="headerlink" href="#testing-your-extractor" title="Link to this heading">#</a></h2>
<section id="test-fixtures-for-real-file-formats">
<h3>Test Fixtures for Real File Formats<a class="headerlink" href="#test-fixtures-for-real-file-formats" title="Link to this heading">#</a></h3>
<p>For testing with actual file formats (especially binary formats like microscopy data), NexusLIMS uses compressed tar archives to store sanitized test files efficiently.</p>
<p><strong>Setting up test fixtures:</strong></p>
<ol class="arabic">
<li><p><strong>Create sanitized test data</strong> - Start with a real microscopy file from your target format, then remove/zero sensitive image data while preserving metadata structure. See <a class="reference internal" href="../dev_guide.html#creating-sanitized-test-files"><span class="std std-ref">Creating Sanitized Test Files</span></a> in the Developer Guide for detailed instructions.</p></li>
<li><p><strong>Add to test archive registry</strong> in <code class="docutils literal notranslate"><span class="pre">tests/unit/utils.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ... existing entries ...</span>
    <span class="s2">&quot;XYZ_FORMAT&quot;</span><span class="p">:</span> <span class="s2">&quot;xyz_format_test_dataZeroed.tar.gz&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><strong>Place archive</strong> in <code class="docutils literal notranslate"><span class="pre">tests/unit/files/</span></code></p></li>
</ol>
<p>The fixture system extracts files from <code class="docutils literal notranslate"><span class="pre">*.tar.gz</span></code> archives to a temporary test directory, makes them available during test execution, and automatically cleans up after tests complete. This keeps the repository small (compressed archives) while enabling tests with realistic file structures and metadata.</p>
</section>
<section id="example-test-file">
<h3>Example Test File<a class="headerlink" href="#example-test-file" title="Link to this heading">#</a></h3>
<p>Create a test file in <code class="docutils literal notranslate"><span class="pre">tests/unit/test_extractors/</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Tests for XYZ extractor.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.extractors.plugins.xyz</span><span class="w"> </span><span class="kn">import</span> <span class="n">XYZExtractor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.extractors.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExtractionContext</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tests.unit.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">extract_files</span><span class="p">,</span> <span class="n">delete_files</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;module&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">xyz_test_file</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract test XYZ file from archive.&quot;&quot;&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">extract_files</span><span class="p">(</span><span class="s2">&quot;XYZ_FORMAT&quot;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Yield the extracted test file</span>
    <span class="n">delete_files</span><span class="p">(</span><span class="s2">&quot;XYZ_FORMAT&quot;</span><span class="p">)</span>  <span class="c1"># Clean up after tests</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TestXYZExtractor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test cases for XYZ format extractor.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_supports_xyz_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that extractor supports .xyz files.&quot;&quot;&quot;</span>
        <span class="n">extractor</span> <span class="o">=</span> <span class="n">XYZExtractor</span><span class="p">()</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">ExtractionContext</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;test.xyz&quot;</span><span class="p">),</span> <span class="n">instrument</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">extractor</span><span class="o">.</span><span class="n">supports</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_rejects_other_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that extractor rejects non-.xyz files.&quot;&quot;&quot;</span>
        <span class="n">extractor</span> <span class="o">=</span> <span class="n">XYZExtractor</span><span class="p">()</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">ExtractionContext</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;test.dm3&quot;</span><span class="p">),</span> <span class="n">instrument</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">extractor</span><span class="o">.</span><span class="n">supports</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_extraction_real_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz_test_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test metadata extraction from real XYZ file.</span>
<span class="sd">        </span>
<span class="sd">        Uses the &quot;xyz_test_file&quot; fixture to automatically extract,</span>
<span class="sd">        read, and then delete the real test file from the compressed</span>
<span class="sd">        archive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.extractors</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_full_meta</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="n">get_full_meta</span><span class="p">(</span><span class="n">xyz_test_file</span><span class="p">,</span> <span class="n">instrument</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Verify extracted metadata</span>
        <span class="k">assert</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;nx_meta&quot;</span><span class="p">][</span><span class="s2">&quot;DatasetType&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Image&quot;</span>
        <span class="k">assert</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;nx_meta&quot;</span><span class="p">][</span><span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">==</span> <span class="mf">15.0</span>
        <span class="c1"># ... additional assertions</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices">
<span id="id4"></span><h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">#</a></h2>
<section id="v2-2-0-schema-patterns">
<h3>v2.2.0 Schema Patterns<a class="headerlink" href="#v2-2-0-schema-patterns" title="Link to this heading">#</a></h3>
<p><strong>Use Pint Quantities consistently:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.schemas.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">ureg</span>

<span class="c1"># ✅ GOOD - Create Quantity for fields with units</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">15000</span><span class="p">,</span> <span class="s2">&quot;volt&quot;</span><span class="p">)</span>  <span class="c1"># Auto-converts to kV</span>
<span class="c1"># For calculations/conversions, use Decimal explicitly:</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;15000&quot;</span><span class="p">),</span> <span class="s2">&quot;volt&quot;</span><span class="p">)</span>

<span class="c1"># ❌ BAD - Don&#39;t use raw numbers for fields with units</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># Missing unit information</span>

<span class="c1"># ✅ GOOD - Dimensionless values as plain numbers</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;magnification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50000</span>

<span class="c1"># ❌ BAD - Don&#39;t create Quantities for dimensionless values</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;magnification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;dimensionless&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Note on Decimal values:</strong> The unit registry auto-converts numeric values to <code class="docutils literal notranslate"><span class="pre">Decimal</span></code> to avoid floating-point precision issues. While <code class="docutils literal notranslate"><span class="pre">ureg.Quantity(15,</span> <span class="pre">&quot;kilovolt&quot;)</span></code> works, using <code class="docutils literal notranslate"><span class="pre">Decimal</span></code> explicitly is recommended when performing calculations or conversions (e.g., <code class="docutils literal notranslate"><span class="pre">Decimal(metadata[&quot;HV&quot;])</span> <span class="pre">*</span> <span class="pre">Decimal(&quot;1e-3&quot;)</span></code>) for clarity and to ensure precision.</p>
<p><strong>Use <code class="docutils literal notranslate"><span class="pre">add_to_extensions()</span></code> for vendor fields:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.schemas.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_to_extensions</span>

<span class="c1"># ✅ GOOD - Use helper function</span>
<span class="n">add_to_extensions</span><span class="p">(</span><span class="n">nx_meta</span><span class="p">,</span> <span class="s2">&quot;fei_detector_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;CBS&quot;</span><span class="p">)</span>
<span class="n">add_to_extensions</span><span class="p">(</span><span class="n">nx_meta</span><span class="p">,</span> <span class="s2">&quot;facility&quot;</span><span class="p">,</span> <span class="s2">&quot;Nexus Lab&quot;</span><span class="p">)</span>

<span class="c1"># ❌ BAD - Manual dict manipulation (doesn&#39;t keep implementation isolated)</span>
<span class="k">if</span> <span class="s2">&quot;extensions&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nx_meta</span><span class="p">:</span>
    <span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;extensions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;extensions&quot;</span><span class="p">][</span><span class="s2">&quot;fei_detector_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CBS&quot;</span>
</pre></div>
</div>
<p><strong>Set DatasetType early:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ✅ GOOD - Set DatasetType first, then add type-specific fields</span>
<span class="n">nx_meta</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;DatasetType&quot;</span><span class="p">:</span> <span class="s2">&quot;Image&quot;</span><span class="p">,</span>  <span class="c1"># Schema selection happens based on this</span>
    <span class="s2">&quot;Data Type&quot;</span><span class="p">:</span> <span class="s2">&quot;SEM_Imaging&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Creation Time&quot;</span><span class="p">:</span> <span class="n">creation_time_iso</span><span class="p">,</span>
<span class="p">}</span>
<span class="c1"># Now add imaging-specific fields</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;kilovolt&quot;</span><span class="p">)</span>

<span class="c1"># ❌ BAD - Adding fields before DatasetType</span>
<span class="n">nx_meta</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;kilovolt&quot;</span><span class="p">)</span>  <span class="c1"># What schema validates this?</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;DatasetType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Image&quot;</span>  <span class="c1"># Too late</span>
</pre></div>
</div>
<p><strong>Handle timezone in Creation Time:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.instruments</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_instr_from_filepath</span>

<span class="c1"># ✅ GOOD - Include timezone</span>
<span class="n">instr</span> <span class="o">=</span> <span class="n">get_instr_from_filepath</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
<span class="n">creation_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">mtime</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="n">instr</span><span class="o">.</span><span class="n">timezone</span> <span class="k">if</span> <span class="n">instr</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;Creation Time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">creation_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>  <span class="c1"># &quot;2024-01-15T10:30:00-05:00&quot;</span>

<span class="c1"># ❌ BAD - Naive datetime (no timezone)</span>
<span class="n">creation_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">mtime</span><span class="p">)</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;Creation Time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">creation_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>  <span class="c1"># &quot;2024-01-15T10:30:00&quot; - FAILS validation</span>
</pre></div>
</div>
</section>
<section id="error-handling">
<h3>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">#</a></h3>
<p>Always handle errors gracefully:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExtractionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract metadata with defensive error handling.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Primary extraction logic (returns list)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_full_metadata</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Error extracting full metadata from </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="c1"># Return basic metadata as fallback (also as list)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_basic_metadata</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Link to this heading">#</a></h3>
<p>Use appropriate log levels:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Extracting metadata from </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>  <span class="c1"># Routine operations</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Discovered unusual format variant in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>  <span class="c1"># Notable events</span>
<span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Missing expected metadata field in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>  <span class="c1"># Recoverable issues</span>
<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to parse </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Serious errors</span>
</pre></div>
</div>
</section>
<section id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Link to this heading">#</a></h3>
<p>For expensive operations, consider lazy evaluation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExtractionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract metadata with lazy loading.&quot;&quot;&quot;</span>
    <span class="c1"># Only load what&#39;s needed</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_header_metadata</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

    <span class="c1"># If using hyperspy, load the signal lazily:</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">original_metadata</span>

    <span class="c1"># Don&#39;t load full data unless necessary</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_full_data</span><span class="p">(</span><span class="n">metadata</span><span class="p">):</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_full_data</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">metadata</span>
</pre></div>
</div>
</section>
</section>
<section id="migration-from-legacy-extractors">
<h2>Migration from Legacy Extractors<a class="headerlink" href="#migration-from-legacy-extractors" title="Link to this heading">#</a></h2>
<p>If you have an existing extraction function (pre-v2.1.0), create a simple wrapper:</p>
<p><strong>Before (legacy):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># In nexusLIMS/extractors/my_format.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_my_format_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="c1"># ... extraction logic</span>
    <span class="k">return</span> <span class="n">metadata</span>
</pre></div>
</div>
<p><strong>After (plugin):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># In nexusLIMS/extractors/plugins/my_format.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.extractors.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExtractionContext</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nexusLIMS.extractors.my_format</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_my_format_metadata</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyFormatExtractor</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;my_format_extractor&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">supported_extensions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;myformat&quot;</span><span class="p">}</span>  <span class="c1"># Declare supported extensions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">supports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExtractionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;myformat&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExtractionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
        <span class="c1"># Legacy function returns dict, wrap in list</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">get_my_format_metadata</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">metadata</span><span class="p">]</span>  <span class="c1"># Always return a list</span>
</pre></div>
</div>
</section>
<section id="registry-behavior">
<h2>Registry Behavior<a class="headerlink" href="#registry-behavior" title="Link to this heading">#</a></h2>
<p>The registry automatically:</p>
<ol class="arabic simple">
<li><p><strong>Discovers plugins</strong> on first use by walking <code class="docutils literal notranslate"><span class="pre">nexusLIMS/extractors/plugins/</span></code></p></li>
<li><p><strong>Sorts by priority</strong> within each file extension</p></li>
<li><p><strong>Calls <code class="docutils literal notranslate"><span class="pre">supports()</span></code></strong> on each extractor in priority order</p></li>
<li><p><strong>Returns first match</strong> where <code class="docutils literal notranslate"><span class="pre">supports()</span></code> returns <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p><strong>Falls back</strong> to BasicFileInfoExtractor if nothing matches</p></li>
</ol>
<p>You don’t need to manually register your plugin - just create the file and it will be discovered automatically.</p>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h2>
<p>See the built-in extractors for real-world examples:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.extractors.plugins.digital_micrograph.html#module-nexusLIMS.extractors.plugins.digital_micrograph" title="nexusLIMS.extractors.plugins.digital_micrograph"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nexusLIMS.extractors.plugins.digital_micrograph</span></code></a> - Simple extension-based matching</p></li>
<li><p><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.extractors.plugins.quanta_tif.html#module-nexusLIMS.extractors.plugins.quanta_tif" title="nexusLIMS.extractors.plugins.quanta_tif"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nexusLIMS.extractors.plugins.quanta_tif</span></code></a> - TIFF format for specific instruments</p></li>
<li><p><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.extractors.plugins.tescan_tif.html#module-nexusLIMS.extractors.plugins.tescan_tif" title="nexusLIMS.extractors.plugins.tescan_tif"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nexusLIMS.extractors.plugins.tescan_tif</span></code></a> - TIFF format with metadata content sniffing and parsing sidecar header file</p></li>
<li><p><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.extractors.plugins.basic_metadata.html#module-nexusLIMS.extractors.plugins.basic_metadata" title="nexusLIMS.extractors.plugins.basic_metadata"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nexusLIMS.extractors.plugins.basic_metadata</span></code></a> - Fallback extractor with priority 0</p></li>
<li><p><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.extractors.plugins.edax.html#module-nexusLIMS.extractors.plugins.edax" title="nexusLIMS.extractors.plugins.edax"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nexusLIMS.extractors.plugins.edax</span></code></a> - Multiple extractors in one file</p></li>
</ul>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">#</a></h2>
<section id="my-extractor-isn-t-being-discovered">
<h3>My extractor isn’t being discovered<a class="headerlink" href="#my-extractor-isn-t-being-discovered" title="Link to this heading">#</a></h3>
<p>Check that:</p>
<ol class="arabic simple">
<li><p>File is in <code class="docutils literal notranslate"><span class="pre">nexusLIMS/extractors/plugins/</span></code> (or subdirectory)</p></li>
<li><p>Class has all required attributes (<code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">priority</span></code>, <code class="docutils literal notranslate"><span class="pre">supported_extensions</span></code>) and methods (<code class="docutils literal notranslate"><span class="pre">supports</span></code>, <code class="docutils literal notranslate"><span class="pre">extract</span></code>)</p></li>
<li><p>Class name doesn’t start with underscore</p></li>
<li><p>No import errors (check logs)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">supported_extensions</span></code> is properly defined as a <code class="docutils literal notranslate"><span class="pre">set</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
</ol>
</section>
<section id="my-extractor-isn-t-being-selected">
<h3>My extractor isn’t being selected<a class="headerlink" href="#my-extractor-isn-t-being-selected" title="Link to this heading">#</a></h3>
<p>Check that:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">supported_extensions</span></code> includes the file’s extension (without dot)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">supports()</span></code> returns <code class="docutils literal notranslate"><span class="pre">True</span></code> for your test file</p></li>
<li><p>Priority is high enough (higher priority extractors are tried first)</p></li>
<li><p>No higher-priority extractor is matching first</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">supported_extensions</span></code> and <code class="docutils literal notranslate"><span class="pre">supports()</span></code> are synchronized (if registered for <code class="docutils literal notranslate"><span class="pre">.xyz</span></code>, <code class="docutils literal notranslate"><span class="pre">supports()</span></code> should return <code class="docutils literal notranslate"><span class="pre">True</span></code> for <code class="docutils literal notranslate"><span class="pre">.xyz</span></code> files)</p></li>
</ol>
<p>Enable debug logging to see selection process:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;nexusLIMS.extractors.registry&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tests-are-failing">
<h3>Tests are failing<a class="headerlink" href="#tests-are-failing" title="Link to this heading">#</a></h3>
<p>Ensure your extractor:</p>
<ol class="arabic simple">
<li><p>Returns a dictionary with <code class="docutils literal notranslate"><span class="pre">&quot;nx_meta&quot;</span></code> key</p></li>
<li><p>Includes required fields in <code class="docutils literal notranslate"><span class="pre">nx_meta</span></code></p></li>
<li><p>Handles missing/corrupted files gracefully</p></li>
<li><p>Uses appropriate timezone for timestamps</p></li>
</ol>
</section>
</section>
<section id="metadata-reference-files">
<h2>Metadata Reference Files<a class="headerlink" href="#metadata-reference-files" title="Link to this heading">#</a></h2>
<p>When developing extractor plugins, it’s helpful to see examples of real metadata structures from different file formats. NexusLIMS maintains a collection of reference metadata files extracted from test data.</p>
<section id="location">
<h3>Location<a class="headerlink" href="#location" title="Link to this heading">#</a></h3>
<p>Reference metadata is stored in <code class="docutils literal notranslate"><span class="pre">tests/unit/files/metadata_references/</span></code> and includes:</p>
<ul class="simple">
<li><p><strong>127 JSON files</strong> containing <code class="docutils literal notranslate"><span class="pre">original_metadata</span></code> from HyperSpy-readable test files</p></li>
<li><p><strong>2 XML files</strong> with raw TIFF metadata from Orion HIM instruments</p></li>
<li><p><strong>README.md</strong> documenting the reference files</p></li>
<li><p><strong>extract_original_metadata.py</strong> script to regenerate the references</p></li>
</ul>
</section>
<section id="contents">
<h3>Contents<a class="headerlink" href="#contents" title="Link to this heading">#</a></h3>
<p>Each JSON file contains the complete <code class="docutils literal notranslate"><span class="pre">original_metadata</span></code> dictionary extracted from a test file using HyperSpy’s <code class="docutils literal notranslate"><span class="pre">signal.original_metadata.as_dictionary()</span></code>. The files are named after their source files:</p>
<ul class="simple">
<li><p>Single-signal files: <code class="docutils literal notranslate"><span class="pre">{filename}_original_metadata.json</span></code></p></li>
<li><p>Multi-signal files: <code class="docutils literal notranslate"><span class="pre">{filename}_signal_{index}_original_metadata.json</span></code></p></li>
</ul>
<p>Format examples covered:</p>
<ul class="simple">
<li><p>Digital Micrograph (.dm3, .dm4) - Various TEM/STEM imaging and spectroscopy modes</p></li>
<li><p>FEI TIA (.emi/.ser) - TEM/STEM images, spectra, and spectrum images</p></li>
<li><p>FEI/Thermo Quanta (.tif) - SEM imaging with embedded metadata</p></li>
<li><p>Zeiss Orion (.tif) - HIM imaging with Fibics or Zeiss metadata</p></li>
<li><p>Tescan (.tif) - SEM/FIB imaging</p></li>
<li><p>HyperSpy (.hspy) - 4D-STEM data</p></li>
</ul>
</section>
<section id="usage-for-extractor-development">
<h3>Usage for Extractor Development<a class="headerlink" href="#usage-for-extractor-development" title="Link to this heading">#</a></h3>
<p><strong>1. Understanding metadata structure</strong></p>
<p>Before writing an extractor, examine the reference metadata to understand:</p>
<ul class="simple">
<li><p>What fields are available in the source format</p></li>
<li><p>How the data is structured (nested dictionaries, lists, etc.)</p></li>
<li><p>Which fields map to NexusLIMS required fields</p></li>
<li><p>What vendor-specific fields exist</p></li>
</ul>
<p>Example workflow:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># View metadata structure for a Quanta TIFF file</span>
less<span class="w"> </span>tests/unit/files/metadata_references/quanta_image_original_metadata.json

<span class="c1"># Search for specific fields</span>
grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;acceleration&quot;</span><span class="w"> </span>tests/unit/files/metadata_references/
</pre></div>
</div>
<p><strong>2. Mapping source fields to nx_meta</strong></p>
<p>Use the reference files to identify which source metadata keys should map to NexusLIMS fields:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: Mapping Quanta TIFF metadata to nx_meta</span>
<span class="c1"># Based on quanta_image_original_metadata.json:</span>
<span class="c1"># {</span>
<span class="c1">#   &quot;User&quot;: {&quot;HV&quot;: &quot;15000.0&quot;, &quot;WD&quot;: &quot;5.2&quot;, ...},</span>
<span class="c1">#   &quot;EScan&quot;: {&quot;DwellTime&quot;: &quot;1e-05&quot;, ...}</span>
<span class="c1"># }</span>

<span class="c1"># The NexusLIMS ureg requires the use of Decimal to ensure the source</span>
<span class="c1"># precision is retained when converting units</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>

<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;acceleration_voltage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span>
    <span class="n">Decimal</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;User&quot;</span><span class="p">][</span><span class="s2">&quot;HV&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;1e-3&quot;</span><span class="p">),</span>  <span class="c1"># Convert V to kV</span>
    <span class="s2">&quot;kilovolt&quot;</span>
<span class="p">)</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;working_distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span>
    <span class="n">Decimal</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;User&quot;</span><span class="p">][</span><span class="s2">&quot;WD&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;millimeter&quot;</span>
<span class="p">)</span>
<span class="n">nx_meta</span><span class="p">[</span><span class="s2">&quot;dwell_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span>
    <span class="n">Decimal</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;EScan&quot;</span><span class="p">][</span><span class="s2">&quot;DwellTime&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;1e6&quot;</span><span class="p">),</span>  <span class="c1"># Convert s to µs</span>
    <span class="s2">&quot;microsecond&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>3. Testing against real metadata</strong></p>
<p>When writing tests, compare your extractor’s output against the reference metadata to ensure you’re handling all available fields correctly.</p>
</section>
<section id="regenerating-reference-files">
<h3>Regenerating Reference Files<a class="headerlink" href="#regenerating-reference-files" title="Link to this heading">#</a></h3>
<p>If test files are added or modified, regenerate the reference metadata:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>tests/unit/files/metadata_references
uv<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>extract_original_metadata.py
</pre></div>
</div>
<p>The script:</p>
<ol class="arabic simple">
<li><p>Extracts all files from test archives (<code class="docutils literal notranslate"><span class="pre">tests/unit/files/*.tar.gz</span></code>)</p></li>
<li><p>Loads each file with HyperSpy</p></li>
<li><p>Exports <code class="docutils literal notranslate"><span class="pre">original_metadata</span></code> as formatted JSON</p></li>
<li><p>Handles both single and multi-signal files automatically</p></li>
</ol>
<p>This is particularly useful after:</p>
<ul class="simple">
<li><p>Adding new test files for a format</p></li>
<li><p>Updating data-zeroing procedures</p></li>
<li><p>Verifying metadata preservation after file modifications</p></li>
</ul>
</section>
<section id="benefits">
<h3>Benefits<a class="headerlink" href="#benefits" title="Link to this heading">#</a></h3>
<p>Using metadata reference files helps you:</p>
<ul class="simple">
<li><p><strong>Write better extractors</strong> - See real-world metadata structure before coding</p></li>
<li><p><strong>Improve field coverage</strong> - Identify fields you might have missed</p></li>
<li><p><strong>Debug extraction issues</strong> - Compare expected vs. actual metadata</p></li>
<li><p><strong>Document metadata evolution</strong> - Track changes in file format metadata over time</p></li>
<li><p><strong>Onboard new developers</strong> - Provide concrete examples of metadata structure</p></li>
</ul>
</section>
</section>
<section id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../user_guide/extractors.html"><span class="std std-doc">Extractor Overview</span></a></p></li>
<li><p><a class="reference internal" href="instrument_profiles.html"><span class="std std-doc">Instrument Profiles</span></a></p></li>
<li><p><a class="reference internal" href="../api/nexusLIMS/nexusLIMS.extractors.html"><span class="std std-doc">API Documentation</span></a></p></li>
</ul>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="development.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Development introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="writing_export_destinations.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Writing Export Destination Plugins</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-start">Quick Start</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#minimal-example">Minimal Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#required-interface">Required Interface</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#class-attributes">Class Attributes</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#name-str"><code class="docutils literal notranslate"><span class="pre">name:</span> <span class="pre">str</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#priority-int"><code class="docutils literal notranslate"><span class="pre">priority:</span> <span class="pre">int</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-extensions-set-str-none"><code class="docutils literal notranslate"><span class="pre">supported_extensions:</span> <span class="pre">set[str]</span> <span class="pre">|</span> <span class="pre">None</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#methods">Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#supports-context-extractioncontext-bool"><code class="docutils literal notranslate"><span class="pre">supports(context:</span> <span class="pre">ExtractionContext)</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-context-extractioncontext-list-dict-str-any"><code class="docutils literal notranslate"><span class="pre">extract(context:</span> <span class="pre">ExtractionContext)</span> <span class="pre">-&gt;</span> <span class="pre">list[dict[str,</span> <span class="pre">Any]]</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metadata-validation">Metadata Validation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-pint-quantities-for-physical-values">Using Pint Quantities for Physical Values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#em-glossary-field-names">EM Glossary Field Names</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#core-fields-vs-extensions">Core Fields vs. Extensions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-patterns">Advanced Patterns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#content-based-detection">Content-Based Detection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#instrument-specific-extractors">Instrument-Specific Extractors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#priority-guidelines">Priority Guidelines</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-your-extractor">Testing Your Extractor</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-fixtures-for-real-file-formats">Test Fixtures for Real File Formats</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-test-file">Example Test File</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#best-practices">Best Practices</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#v2-2-0-schema-patterns">v2.2.0 Schema Patterns</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#error-handling">Error Handling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logging">Logging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performance">Performance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#migration-from-legacy-extractors">Migration from Legacy Extractors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#registry-behavior">Registry Behavior</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#my-extractor-isn-t-being-discovered">My extractor isn’t being discovered</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#my-extractor-isn-t-being-selected">My extractor isn’t being selected</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tests-are-failing">Tests are failing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metadata-reference-files">Metadata Reference Files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#location">Location</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contents">Contents</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-for-extractor-development">Usage for Extractor Development</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regenerating-reference-files">Regenerating Reference Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#benefits">Benefits</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-reading">Further Reading</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/dev_guide/writing_extractor_plugins.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025 - 2026, datasophos, LLC.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>