
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Database Migrations &#8212; NexusLIMS dev documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=acda69ee" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=3ce10a4d"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=30646c52"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/migrations';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = '_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            true;
        </script>
    <script src="../_static/custom.js?v=ba087cdf"></script>
    <link rel="canonical" href="https://datasophos.github.io/NexusLIMS/latest/user_guide/migrations.html" />
    <link rel="icon" href="../_static/nexusLIMS_bare_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Extractors" href="extractors.html" />
    <link rel="prev" title="Instrument Management" href="instrument_manager.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="dev" />
    <meta name="docbuild:last-update" content="Feb, 20, 2026"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_horizontal_light.png" class="logo__image only-light" alt="NexusLIMS dev documentation - Home"/>
    <img src="../_static/logo_horizontal_dark.png" class="logo__image only-dark pst-js-only" alt="NexusLIMS dev documentation - Home"/>
  
  
</a></div>
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    Home
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../migration_guide.html">
    Migration Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../dev_guide.html">
    Dev Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../frontend_guide.html">
    Frontend Guide
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../reference.html">
    Reference
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/datasophos/NexusLIMS" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://datasophos.co" title="Datasophos" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-globe fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Datasophos</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    Home
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../migration_guide.html">
    Migration Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../dev_guide.html">
    Dev Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../frontend_guide.html">
    Frontend Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/datasophos/NexusLIMS" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://datasophos.co" title="Datasophos" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-globe fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Datasophos</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html">Command-Line Interface Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="record_building.html">Record building workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="instrument_manager.html">Instrument Management</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Database Migrations</a></li>

<li class="toctree-l1"><a class="reference internal" href="extractors.html">Extractors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/standalone_extractor_usage.html">Standalone Extractor Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="exporters.html">Export Destinations</a></li>
<li class="toctree-l1"><a class="reference internal" href="taxonomy.html">NexusLIMS Taxonomy</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../user_guide.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Database Migrations</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="database-migrations">
<h1>Database Migrations<a class="headerlink" href="#database-migrations" title="Link to this heading">#</a></h1>
</section>
<section id="nexuslims-database-migrations">
<h1>NexusLIMS Database Migrations<a class="headerlink" href="#nexuslims-database-migrations" title="Link to this heading">#</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">nexusLIMS/db/migrations</span></code> directory in the NexusLIMS source code contains
<a class="reference external" href="https://alembic.sqlalchemy.org/">Alembic</a> database migration scripts for NexusLIMS.
Migrations provide version control for the database schema, making it safe to upgrade
existing installations and ensuring schema consistency across deployments.</p>
<section id="directory-structure">
<h2>Directory Structure<a class="headerlink" href="#directory-structure" title="Link to this heading">#</a></h2>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>nexusLIMS/db/migrations/
├── README.md                                    # This file
├── env.py                                       # Migration environment configuration
├── utils.py                                     # Backup and verification utilities
├── script.py.mako                               # Template for new migration scripts
└── versions/                                    # Migration scripts (version-based IDs)
    ├── v1_4_3_initial_schema_baseline.py        # v1.4.3: instruments + session_log
    ├── v2_4_0a_add_upload_log_table.py         # v2.4.0: upload_log table
    └── v2_4_0b_add_check_constraints.py        # v2.4.0: CHECK constraints
</pre></div>
</div>
</section>
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Link to this heading">#</a></h2>
<p><strong>Note:</strong> The <code class="docutils literal notranslate"><span class="pre">nexuslims</span> <span class="pre">db</span></code> command will use the <code class="docutils literal notranslate"><span class="pre">NX_DB_PATH</span></code> setting
configured in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. If you would like to operate on a different
database file, you will need to set that variable in every command, such as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">NX_DB_PATH</span><span class="o">=</span>/path/to/other/database.sqlite<span class="w"> </span>nexuslims<span class="w"> </span>db<span class="w"> </span>check
</pre></div>
</div>
<section id="new-installations">
<h3>New Installations<a class="headerlink" href="#new-installations" title="Link to this heading">#</a></h3>
<p>To initialize a new NexusLIMS database with the latest schema, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nexuslims<span class="w"> </span>db<span class="w"> </span>init
</pre></div>
</div>
<p>This creates the database file at <code class="docutils literal notranslate"><span class="pre">NX_DB_PATH</span></code>, applies all migrations, and marks it as current.</p>
</section>
<section id="existing-installations">
<h3>Existing Installations<a class="headerlink" href="#existing-installations" title="Link to this heading">#</a></h3>
<section id="upgrading-from-v1-4-3">
<h4>Upgrading from v1.4.3<a class="headerlink" href="#upgrading-from-v1-4-3" title="Link to this heading">#</a></h4>
<p>If you have a v1.4.3 database from a prior installation of NexusLIMS,
you will first have to mark it as at the baseline version, and then and apply
updates to make the database compatible with the current version of NexusLIMS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mark database as having the v1.4.3 baseline schema</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>alembic<span class="w"> </span>stamp<span class="w"> </span>v1_4_3

<span class="c1"># Apply pending migrations (v2.4.0 updates)</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>upgrade

<span class="c1"># Check the current version</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>check
</pre></div>
</div>
<p>The last command should output something like the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>✓ Database is up-to-date (revision: v2_4_0b)
</pre></div>
</div>
</section>
</section>
</section>
<section id="common-commands">
<h2>Common Commands<a class="headerlink" href="#common-commands" title="Link to this heading">#</a></h2>
<section id="check-status">
<h3>Check Status<a class="headerlink" href="#check-status" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show current database version</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>current

<span class="c1"># Check for pending migrations</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>check

<span class="c1"># View migration history</span>
nexuslims<span class="w"> </span>db<span class="w"> </span><span class="nb">history</span>
</pre></div>
</div>
</section>
<section id="upgrade-downgrade">
<h3>Upgrade/Downgrade<a class="headerlink" href="#upgrade-downgrade" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Upgrade to latest schema</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>upgrade

<span class="c1"># Upgrade to specific version</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>upgrade<span class="w"> </span>v2_4_0a

<span class="c1"># Downgrade one migration</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>downgrade

<span class="c1"># Downgrade to specific version</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>downgrade<span class="w"> </span>v1_4_3
</pre></div>
</div>
</section>
<section id="advanced-commands-including-alembic-cli">
<h3>Advanced Commands (including Alembic CLI)<a class="headerlink" href="#advanced-commands-including-alembic-cli" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># View detailed history</span>
nexuslims<span class="w"> </span>db<span class="w"> </span><span class="nb">history</span><span class="w"> </span>--verbose

<span class="c1"># Generate SQL without applying (to preview)</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>upgrade<span class="w"> </span>--sql

<span class="c1"># all Alembic commands are also available through `nexuslims db alembic`:</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>alembic<span class="w"> </span><span class="o">[</span>COMMAND<span class="o">]</span><span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
</section>
</section>
<section id="creating-new-migrations-for-developers">
<h2>Creating New Migrations (for developers)<a class="headerlink" href="#creating-new-migrations-for-developers" title="Link to this heading">#</a></h2>
<p>When you modify the database schema (SQLModel models in <code class="docutils literal notranslate"><span class="pre">nexusLIMS/db/models.py</span></code>):</p>
<ol class="arabic">
<li><p><strong>Edit the models</strong> in <code class="docutils literal notranslate"><span class="pre">nexusLIMS/db/models.py</span></code></p></li>
<li><p><strong>Generate migration</strong> (requires source checkout):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nexuslims<span class="w"> </span>db<span class="w"> </span>alembic<span class="w"> </span>revision<span class="w"> </span>--autogenerate<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Add field to SessionLog&quot;</span>
</pre></div>
</div>
<p>This creates a new migration with a version-based ID (e.g., <code class="docutils literal notranslate"><span class="pre">v2_5_0_add_field_to_sessionlog.py</span></code>)</p>
</li>
<li><p><strong>Review generated script</strong> in <code class="docutils literal notranslate"><span class="pre">versions/</span></code> directory</p>
<ul class="simple">
<li><p>Check SQL operations are correct</p></li>
<li><p>Add data verification if needed (use <code class="docutils literal notranslate"><span class="pre">verify_table_integrity()</span></code> from <code class="docutils literal notranslate"><span class="pre">utils.py</span></code>)</p></li>
<li><p>Update upgrade() and downgrade() functions as needed</p></li>
</ul>
</li>
<li><p><strong>Test migration</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nexuslims<span class="w"> </span>db<span class="w"> </span>upgrade<span class="w">      </span><span class="c1"># Apply</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>downgrade<span class="w">    </span><span class="c1"># Rollback</span>
nexuslims<span class="w"> </span>db<span class="w"> </span>upgrade<span class="w">      </span><span class="c1"># Re-apply</span>
</pre></div>
</div>
</li>
<li><p><strong>Commit migration script</strong> to version control</p></li>
</ol>
</section>
<section id="migration-features">
<h2>Migration Features<a class="headerlink" href="#migration-features" title="Link to this heading">#</a></h2>
<section id="automatic-backups">
<h3>Automatic Backups<a class="headerlink" href="#automatic-backups" title="Link to this heading">#</a></h3>
<p>Migrations automatically create timestamped backups before making changes:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>✓ Database backup created: database_backup_20260207_143216.sqlite
</pre></div>
</div>
<p>New database initialization (via <code class="docutils literal notranslate"><span class="pre">init</span></code>) skips backups since there’s no data to protect.</p>
</section>
<section id="data-integrity-verification">
<h3>Data Integrity Verification<a class="headerlink" href="#data-integrity-verification" title="Link to this heading">#</a></h3>
<p>Migrations that recreate tables automatically verify data is preserved:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>→ Migrating 2270 session logs...
✓ Data integrity verified: 23 instruments, 2270 session logs preserved
</pre></div>
</div>
<p>Empty databases skip verification messages.</p>
</section>
<section id="smart-output">
<h3>Smart Output<a class="headerlink" href="#smart-output" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>New databases</strong>: Clean, minimal output</p></li>
<li><p><strong>Existing databases</strong>: Detailed progress and verification</p></li>
</ul>
</section>
</section>
<section id="version-based-migration-ids">
<h2>Version-Based Migration IDs<a class="headerlink" href="#version-based-migration-ids" title="Link to this heading">#</a></h2>
<p>Migration IDs use semantic versioning instead of random hex:</p>
<ul class="simple">
<li><p><strong>v1_4_3</strong>: Baseline schema from NexusLIMS v1.4.3</p></li>
<li><p><strong>v2_4_0a</strong>: First migration in v2.4.0 (upload_log)</p></li>
<li><p><strong>v2_4_0b</strong>: Second migration in v2.4.0 (CHECK constraints)</p></li>
</ul>
<p>This makes it immediately clear which NexusLIMS version introduced each database change.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Database path</strong>: Automatically reads from <code class="docutils literal notranslate"><span class="pre">NX_DB_PATH</span></code> environment variable</p></li>
<li><p><strong>Migration location</strong>: Configured in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> under <code class="docutils literal notranslate"><span class="pre">[tool.alembic]</span></code></p></li>
<li><p><strong>Environment setup</strong>: <code class="docutils literal notranslate"><span class="pre">env.py</span></code> configures migration context and automatic backups</p></li>
</ul>
</section>
<section id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://alembic.sqlalchemy.org/">Alembic Documentation</a></p></li>
<li><p><a class="reference internal" href="../dev_guide/database.html"><span class="std std-doc">NexusLIMS Database Documentation</span></a></p></li>
<li><p><a class="reference internal" href="cli_reference.html"><span class="std std-doc">NexusLIMS CLI Reference</span></a></p></li>
<li><p><a class="reference external" href="https://sqlmodel.tiangolo.com/">SQLModel Documentation</a></p></li>
</ul>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="instrument_manager.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Instrument Management</p>
      </div>
    </a>
    <a class="right-next"
       href="extractors.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Extractors</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Database Migrations</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#nexuslims-database-migrations">NexusLIMS Database Migrations</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#directory-structure">Directory Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-start">Quick Start</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#new-installations">New Installations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#existing-installations">Existing Installations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrading-from-v1-4-3">Upgrading from v1.4.3</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#common-commands">Common Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-status">Check Status</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade-downgrade">Upgrade/Downgrade</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-commands-including-alembic-cli">Advanced Commands (including Alembic CLI)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-new-migrations-for-developers">Creating New Migrations (for developers)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#migration-features">Migration Features</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-backups">Automatic Backups</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-integrity-verification">Data Integrity Verification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#smart-output">Smart Output</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#version-based-migration-ids">Version-Based Migration IDs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources">Resources</a></li>
</ul>
</li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user_guide/migrations.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025 - 2026, datasophos, LLC.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>